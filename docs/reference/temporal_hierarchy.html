<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>General Interface for Temporal Hierarchical Forecasting (THIEF) Models — temporal_hierarchy • modeltime</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  

<meta property="og:title" content="General Interface for Temporal Hierarchical Forecasting (THIEF) Models — temporal_hierarchy" />
<meta property="og:description" content="temporal_hierarchy() is a way to generate a specification of an Temporal Hierarchical Forecasting model
before fitting and allows the model to be created using
different packages. Currently the only package is thief. Note this
function requires the thief package to be installed." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-2');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">modeltime</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/getting-started-with-modeltime.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Forecasting</li>
    <li>
      <a href="../articles/getting-started-with-modeltime.html">Getting Started with Modeltime</a>
    </li>
    <li>
      <a href="../articles/recursive-forecasting.html">Autoregressive Forecasting (Recursive)</a>
    </li>
    <li>
      <a href="../articles/parallel-processing.html">Hyperparameter Tuning &amp; Parallel Processing</a>
    </li>
    <li>
      <a href="../articles/modeling-panel-data.html">Forecasting Panel Data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Nested Forecasting</li>
    <li>
      <a href="../articles/nested-forecasting.html">Getting Started with Nested Forecasting</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Algorithms</li>
    <li>
      <a href="../articles/modeltime-model-list.html">Modeltime Algorithm Roadmap</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Developers</li>
    <li>
      <a href="../articles/extending-modeltime.html">Extending Modeltime (Developer Tools)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    API
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">API Functions</li>
    <li>
      <a href="../reference/index.html">
        <span class="fa fa-home"></span>
         
        Function Reference
      </a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Change History</li>
    <li>
      <a href="../news/index.html">News</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Ecosystem
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Forecast</li>
    <li>
      <a href="https://business-science.github.io/modeltime/">Modeltime (Forecasting)</a>
    </li>
    <li>
      <a href="https://business-science.github.io/timetk/">TimeTK (Time Series Analysis)</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Improve</li>
    <li>
      <a href="https://business-science.github.io/modeltime.ensemble/">Modeltime Ensemble (Blending Forecasts)</a>
    </li>
    <li>
      <a href="https://business-science.github.io/modeltime.resample/">Modeltime Resample (Backtesting)</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Scale</li>
    <li>
      <a href="https://business-science.github.io/modeltime.h2o/">Modeltime H2O (AutoML)</a>
    </li>
    <li>
      <a href="https://business-science.github.io/modeltime.gluonts/">Modeltime GluonTS (Deep Learning)</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/">
    <span class="fas fa-graduation-cap"></span>
     
    Learn
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/business-science/modeltime">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>General Interface for Temporal Hierarchical Forecasting (THIEF) Models</h1>
    <small class="dont-index">Source: <a href='https://github.com/business-science/modeltime/blob/master/R/parsnip-temporal_hierarchy.R'><code>R/parsnip-temporal_hierarchy.R</code></a></small>
    <div class="hidden name"><code>temporal_hierarchy.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>temporal_hierarchy()</code> is a way to generate a <em>specification</em> of an Temporal Hierarchical Forecasting model
before fitting and allows the model to be created using
different packages. Currently the only package is <code>thief</code>. Note this
function requires the <code>thief</code> package to be installed.</p>
    </div>

    <pre class="usage"><span class='fu'>temporal_hierarchy</span><span class='op'>(</span>
  mode <span class='op'>=</span> <span class='st'>"regression"</span>,
  seasonal_period <span class='op'>=</span> <span class='cn'>NULL</span>,
  combination_method <span class='op'>=</span> <span class='cn'>NULL</span>,
  use_model <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>mode</th>
      <td><p>A single character string for the type of model.
The only possible value for this model is "regression".</p></td>
    </tr>
    <tr>
      <th>seasonal_period</th>
      <td><p>A seasonal frequency. Uses "auto" by default.
A character phrase of "auto" or time-based phrase of "2 weeks"
can be used if a date or date-time variable is provided.
See Fit Details below.</p></td>
    </tr>
    <tr>
      <th>combination_method</th>
      <td><p>Combination method of temporal hierarchies, taking one of the following values:</p><ul>
<li><p>"struc" - Structural scaling: weights from temporal hierarchy</p></li>
<li><p>"mse" - Variance scaling: weights from in-sample MSE</p></li>
<li><p>"ols" - Unscaled OLS combination weights</p></li>
<li><p>"bu" - Bottom-up combination – i.e., all aggregate forecasts are ignored.</p></li>
<li><p>"shr" - GLS using a shrinkage (to block diagonal) estimate of residuals</p></li>
<li><p>"sam" - GLS using sample covariance matrix of residuals</p></li>
</ul></td>
    </tr>
    <tr>
      <th>use_model</th>
      <td><p>Model used for forecasting each aggregation level:</p><ul>
<li><p>"ets" - exponential smoothing</p></li>
<li><p>"arima" - arima</p></li>
<li><p>"theta" - theta</p></li>
<li><p>"naive" - random walk forecasts</p></li>
<li><p>"snaive" - seasonal naive forecasts, based on the last year of observed data</p></li>
</ul></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Models can be created using the following <em>engines</em>:</p><ul>
<li><p>"thief" (default) - Connects to <code><a href='http://robjhyndman.github.io/thief/reference/thief.html'>thief::thief()</a></code></p></li>
</ul>

    <h2 class="hasAnchor" id="engine-details"><a class="anchor" href="#engine-details"></a>Engine Details</h2>

    


<p>The standardized parameter names in <code>modeltime</code> can be mapped to their original
names in each engine:</p><table class='table'>
<tr><td>modeltime</td><td>thief::thief()</td></tr>
<tr><td>combination_method</td><td>comb</td></tr>
<tr><td>use_model</td><td>usemodel</td></tr>
</table>



<p>Other options can be set using <code><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine()</a></code>.</p>
<p><strong>thief (default engine)</strong></p>
<p>The engine uses <code><a href='http://robjhyndman.github.io/thief/reference/thief.html'>thief::thief()</a></code>.</p>
<p>Function Parameters:</p><pre><span class='co'>## function (y, m = frequency(y), h = m * 2, comb = c("struc", "mse", "ols", </span>
<span class='co'>##     "bu", "shr", "sam"), usemodel = c("ets", "arima", "theta", "naive", </span>
<span class='co'>##     "snaive"), forecastfunction = NULL, aggregatelist = NULL, ...)</span>
</pre>

<p>Other options and argument can be set using <code><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine()</a></code>.</p>
<p>Parameter Notes:</p><ul>
<li><p><code>xreg</code> - This model is not set up to use exogenous regressors. Only univariate
models will be fit.</p></li>
</ul>

    <h2 class="hasAnchor" id="fit-details"><a class="anchor" href="#fit-details"></a>Fit Details</h2>

    


<p><strong>Date and Date-Time Variable</strong></p>
<p>It's a requirement to have a date or date-time variable as a predictor.
The <code><a href='https://generics.r-lib.org/reference/fit.html'>fit()</a></code> interface accepts date and date-time features and handles them internally.</p><ul>
<li><p><code><a href='https://generics.r-lib.org/reference/fit.html'>fit(y ~ date)</a></code></p></li>
</ul>

<p><strong>Univariate:</strong></p>
<p>For univariate analysis, you must include a date or date-time feature. Simply use:</p><ul>
<li><p>Formula Interface (recommended): <code><a href='https://generics.r-lib.org/reference/fit.html'>fit(y ~ date)</a></code> will ignore xreg's.</p></li>
<li><p>XY Interface: <code><a href='https://generics.r-lib.org/reference/fit_xy.html'>fit_xy(x = data[,"date"], y = data$y)</a></code> will ignore xreg's.</p></li>
</ul>

<p><strong>Multivariate (xregs, Exogenous Regressors)</strong></p>
<p>This model is not set up for use with exogenous regressors.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    
<ul>
<li><p>For forecasting with temporal hierarchies see: Athanasopoulos G., Hyndman R.J., Kourentzes N., Petropoulos F. (2017) Forecasting with Temporal Hierarchies. <em>European Journal of Operational research</em>, <b>262</b>(<b>1</b>), 60-74.</p></li>
<li><p>For combination operators see: Kourentzes N., Barrow B.K., Crone S.F. (2014) Neural network ensemble operators for time series forecasting. <em>Expert Systems with Applications</em>, <b>41</b>(<b>9</b>), 4235-4244.</p></li>
</ul>

    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://parsnip.tidymodels.org/reference/fit.html'>fit.model_spec()</a></code>, <code><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine()</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://parsnip.tidymodels.org'>parsnip</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://rsample.tidymodels.org'>rsample</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/business-science/timetk'>timetk</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/business-science/modeltime'>modeltime</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://pkg.robjhyndman.com/thief'>thief</a></span><span class='op'>)</span>

<span class='co'># Data</span>
<span class='va'>m750</span> <span class='op'>&lt;-</span> <span class='va'>m4_monthly</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>id</span> <span class='op'>==</span> <span class='st'>"M750"</span><span class='op'>)</span>
<span class='va'>m750</span>
</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 306 × 3</span>
#&gt;    id    date       value
#&gt;    <span style='color: #949494; font-style: italic;'>&lt;fct&gt;</span> <span style='color: #949494; font-style: italic;'>&lt;date&gt;</span>     <span style='color: #949494; font-style: italic;'>&lt;dbl&gt;</span>
#&gt; <span style='color: #BCBCBC;'> 1</span> M750  1990-01-01  <span style='text-decoration: underline;'>6</span>370
#&gt; <span style='color: #BCBCBC;'> 2</span> M750  1990-02-01  <span style='text-decoration: underline;'>6</span>430
#&gt; <span style='color: #BCBCBC;'> 3</span> M750  1990-03-01  <span style='text-decoration: underline;'>6</span>520
#&gt; <span style='color: #BCBCBC;'> 4</span> M750  1990-04-01  <span style='text-decoration: underline;'>6</span>580
#&gt; <span style='color: #BCBCBC;'> 5</span> M750  1990-05-01  <span style='text-decoration: underline;'>6</span>620
#&gt; <span style='color: #BCBCBC;'> 6</span> M750  1990-06-01  <span style='text-decoration: underline;'>6</span>690
#&gt; <span style='color: #BCBCBC;'> 7</span> M750  1990-07-01  <span style='text-decoration: underline;'>6</span>000
#&gt; <span style='color: #BCBCBC;'> 8</span> M750  1990-08-01  <span style='text-decoration: underline;'>5</span>450
#&gt; <span style='color: #BCBCBC;'> 9</span> M750  1990-09-01  <span style='text-decoration: underline;'>6</span>480
#&gt; <span style='color: #BCBCBC;'>10</span> M750  1990-10-01  <span style='text-decoration: underline;'>6</span>820
#&gt; <span style='color: #949494;'># … with 296 more rows</span></div><div class='input'>
<span class='co'># Split Data 80/20</span>
<span class='va'>splits</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rsample.tidymodels.org/reference/initial_split.html'>initial_time_split</a></span><span class='op'>(</span><span class='va'>m750</span>, prop <span class='op'>=</span> <span class='fl'>0.8</span><span class='op'>)</span>

<span class='co'># ---- HIERARCHICAL ----</span>

<span class='co'># Model Spec - The default parameters are all set</span>
<span class='co'># to "auto" if none are provided</span>
<span class='va'>model_spec</span> <span class='op'>&lt;-</span> <span class='fu'>temporal_hierarchy</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://parsnip.tidymodels.org/reference/set_engine.html'>set_engine</a></span><span class='op'>(</span><span class='st'>"thief"</span><span class='op'>)</span>

<span class='co'># Fit Spec</span>
<span class='va'>model_fit</span> <span class='op'>&lt;-</span> <span class='va'>model_spec</span> <span class='op'>%&gt;%</span>
    <span class='fu'><a href='https://generics.r-lib.org/reference/fit.html'>fit</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span><span class='op'>(</span><span class='va'>value</span><span class='op'>)</span> <span class='op'>~</span> <span class='va'>date</span>, data <span class='op'>=</span> <span class='fu'><a href='https://rsample.tidymodels.org/reference/initial_split.html'>training</a></span><span class='op'>(</span><span class='va'>splits</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>frequency = 12 observations per 1 year</span></div><div class='output co'>#&gt; <span class='warning'>Warning: `type_convert()` only converts columns of type 'character'.</span>
#&gt; <span class='warning'>- `df` has no columns of type 'character'</span></div><div class='output co'>#&gt; <span class='warning'>Warning: `type_convert()` only converts columns of type 'character'.</span>
#&gt; <span class='warning'>- `df` has no columns of type 'character'</span></div><div class='output co'>#&gt; <span class='warning'>Warning: `type_convert()` only converts columns of type 'character'.</span>
#&gt; <span class='warning'>- `df` has no columns of type 'character'</span></div><div class='input'><span class='va'>model_fit</span>
</div><div class='output co'>#&gt; parsnip model object
#&gt; 
#&gt; Fit time:  1.5s 
#&gt;         Jan      Feb      Mar      Apr      May      Jun      Jul      Aug
#&gt; 21                                     9.292876 9.278808 9.177530 9.161701
#&gt; 22 9.292288 9.290665 9.310183 9.314852 9.318892 9.304824 9.203573 9.187635
#&gt; 23 9.318275 9.316547 9.336091 9.340759                                    
#&gt;         Sep      Oct      Nov      Dec
#&gt; 21 9.210732 9.279095 9.292842 9.296845
#&gt; 22 9.236714 9.305078 9.318782 9.322784
#&gt; 23                                    </div><div class='input'>



</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Matt Dancho.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


