<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forecasting with Global Models • modeltime</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Forecasting with Global Models">
<meta property="og:description" content="modeltime">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">modeltime</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/getting-started-with-modeltime.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Getting Started</li>
    <li>
      <a href="../articles/getting-started-with-modeltime.html">Getting Started with Modeltime</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Forecasting Many Time Series (Scale)</li>
    <li>
      <a href="../articles/modeling-panel-data.html">Global Model Forecasting</a>
    </li>
    <li>
      <a href="../articles/nested-forecasting.html">Iterative (Nested) Forecasting</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Advanced Topics</li>
    <li>
      <a href="../articles/recursive-forecasting.html">Autoregressive Forecasting (Recursive)</a>
    </li>
    <li>
      <a href="../articles/parallel-processing.html">Hyperparameter Tuning &amp; Parallel Processing</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Algorithms</li>
    <li>
      <a href="../articles/modeltime-model-list.html">Modeltime Algorithm Roadmap</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Developers</li>
    <li>
      <a href="../articles/extending-modeltime.html">Extending Modeltime (Developer Tools)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    API
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">API Functions</li>
    <li>
      <a href="../reference/index.html">
        <span class="fa fa-home"></span>
         
        Function Reference
      </a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Change History</li>
    <li>
      <a href="../news/index.html">News</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Ecosystem
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Forecast</li>
    <li>
      <a href="https://business-science.github.io/modeltime/">Modeltime (Forecasting)</a>
    </li>
    <li>
      <a href="https://business-science.github.io/timetk/">TimeTK (Time Series Analysis)</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Improve</li>
    <li>
      <a href="https://business-science.github.io/modeltime.ensemble/">Modeltime Ensemble (Blending Forecasts)</a>
    </li>
    <li>
      <a href="https://business-science.github.io/modeltime.resample/">Modeltime Resample (Backtesting)</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Scale</li>
    <li>
      <a href="https://business-science.github.io/modeltime.h2o/">Modeltime H2O (AutoML)</a>
    </li>
    <li>
      <a href="https://business-science.github.io/modeltime.gluonts/">Modeltime GluonTS (Deep Learning)</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/">
    <span class="fas fa-graduation-cap"></span>
     
    Learn
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/business-science/modeltime">
    <span class="fab fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="modeling-panel-data_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Forecasting with Global Models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/modeltime/blob/master/vignettes/modeling-panel-data.Rmd"><code>vignettes/modeling-panel-data.Rmd</code></a></small>
      <div class="hidden name"><code>modeling-panel-data.Rmd</code></div>

    </div>

    
    
<p><img src="panel_data_success.jpg" width="100%" style="display: block; margin: auto;"></p>
<p><br><img src="logo-modeltime.png" width="147" height="170" align="right"></p>
<p><strong>Why is global modeling important for time series?</strong> For starters, the ability to forecast many time series with a single model that is trained on many time series groups was a winning strategy in recent Kaggle M5 Forecasting Competition. In fact, it’s the solution we recommend in our <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/">Time Series Course</a> when forecasting many time series as part of a high-performance forecasting system. Why? Because it speeds up forecasting, allowing the data scientist to more rapidly experiment and find good solutions.</p>
<div id="global-forecasting" class="section level1">
<h1 class="hasAnchor">
<a href="#global-forecasting" class="anchor"></a>Global Forecasting</h1>
<p>In general, there are two methods for forecasting at scale (a slow and accurate method and a fast and good method):</p>
<ol style="list-style-type: decimal">
<li><p><strong>Iterative Forecasting (Slow and Accurate):</strong> Best for accuracy but takes <em>much longer</em> than global model (due to for-loop iteration), results in many models (more memory required), and is often needed to be run in parallel to scale to thousands of time series (otherwise it can take days to complete). But, iterative forecasting can yield great results. See <a href="https://business-science.github.io/modeltime/articles/nested-forecasting.html">Nested Forecasting</a> for our Iterative Forecasting implementation.</p></li>
<li><p><strong>Global Modeling (Fast and Good):</strong> Best for scalability to thousands of time series. Uses a Panel Data structure. Can scale to 10,000+ time series easily because only a single model is made that generates predictions (forecasts) for all of the time series. Requires feature engineering and parameter tuning to get best performance, which can be challenging for beginners.</p></li>
</ol>
</div>
<div id="important-concepts" class="section level1">
<h1 class="hasAnchor">
<a href="#important-concepts" class="anchor"></a>Important Concepts</h1>
<p>Students can struggle with global modeling. To help, I have a few terms to cover that will help you understand how global modeling works (and how it differs from iterative modeling).</p>
<div id="panel-data" class="section level2">
<h2 class="hasAnchor">
<a href="#panel-data" class="anchor"></a>Panel Data</h2>
<p><strong>The panel data structure</strong> is the format used for global modeling. In it’s simplest form, <em>Panel Data</em> is a time series dataset that has more than one series. Each time series is stacked row-wise (on-top) of each other.</p>
<div class="figure" style="text-align: center">
<img src="panel_data.jpg" alt="Panel Data Structure" width="100%"><p class="caption">
Panel Data Structure
</p>
</div>
</div>
<div id="traditional-modeling-iteration" class="section level2">
<h2 class="hasAnchor">
<a href="#traditional-modeling-iteration" class="anchor"></a>Traditional Modeling (Iteration)</h2>
<p><strong>Traditional modeling techniques like ARIMA</strong> can only be used on one time series at a time. The widely accepted forecasting approach is to iterate through each time series producing a unique model and forecast for each time series identifier. The downside with this approach is that it’s expensive when you have many time series. Think of the number of products in a database. As the number of time series approaches the range of 1000-10,000, <strong>the iterative approach becomes unscalable.</strong></p>
<div class="figure" style="text-align: center">
<img src="panel_data_arima.jpg" alt="Problem: 1000 ARIMA Models Needed for 1000 Time Series" width="100%"><p class="caption">
Problem: 1000 ARIMA Models Needed for 1000 Time Series
</p>
</div>
</div>
<div id="global-modeling" class="section level2">
<h2 class="hasAnchor">
<a href="#global-modeling" class="anchor"></a>Global Modeling</h2>
<p><strong>Global Models</strong> are alternatives to the iterative approach. A Global Model is a single model that forecasts all time series at once. Global Models are highly scalable, which solves the problem of 1-10,000 time series. An example is an XGBoost Model, which can determine relationships for all 1000 time series panels with a single model.</p>
<div class="figure" style="text-align: center">
<img src="panel_data_xgboost.jpg" alt="Solution: A Single XGBOOST Model can Model 1000 Time Series" width="100%"><p class="caption">
Solution: A Single XGBOOST Model can Model 1000 Time Series
</p>
</div>
</div>
<div id="importance-of-feature-engineering" class="section level2">
<h2 class="hasAnchor">
<a href="#importance-of-feature-engineering" class="anchor"></a>Importance of Feature Engineering</h2>
<p>The downside is that an global approach can be less accurate. To improve accuracy, <strong>feature engineering and localized model selection</strong> by time series identifier become critical to large-scale forecasting success. We recommend learning feature engineering techniques that are proven to get results in our <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/">Time Series Forecasting Course</a>.</p>
<div class="figure" style="text-align: center">
<img src="panel_data_success.jpg" alt="Modeling Panel Data" width="100%"><p class="caption">
Modeling Panel Data
</p>
</div>
</div>
</div>
<div id="getting-started" class="section level1">
<h1 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting Started</h1>
<p>We’ll cover a short tutorial on global forecasting. The first thing to do is to load the following libraries:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/modeltime">modeltime</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/timetk">timetk</a></span><span class="op">)</span></code></pre></div>
<div id="dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#dataset" class="anchor"></a>Dataset</h2>
<p>Next, let’s use the <code>walmart_sales_weekly</code> dataset that comes with <code>timetk</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_tbl</span> <span class="op">&lt;-</span> <span class="va">walmart_sales_weekly</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">Date</span>, <span class="va">Weekly_Sales</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rlang.r-lib.org/reference/set_names.html">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"date"</span>, <span class="st">"value"</span><span class="op">)</span><span class="op">)</span>

<span class="va">data_tbl</span>
<span class="co">#&gt; # A tibble: 1,001 × 3</span>
<span class="co">#&gt;    id    date        value</span>
<span class="co">#&gt;    &lt;fct&gt; &lt;date&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1_1   2010-02-05 24924.</span>
<span class="co">#&gt;  2 1_1   2010-02-12 46039.</span>
<span class="co">#&gt;  3 1_1   2010-02-19 41596.</span>
<span class="co">#&gt;  4 1_1   2010-02-26 19404.</span>
<span class="co">#&gt;  5 1_1   2010-03-05 21828.</span>
<span class="co">#&gt;  6 1_1   2010-03-12 21043.</span>
<span class="co">#&gt;  7 1_1   2010-03-19 22137.</span>
<span class="co">#&gt;  8 1_1   2010-03-26 26229.</span>
<span class="co">#&gt;  9 1_1   2010-04-02 57258.</span>
<span class="co">#&gt; 10 1_1   2010-04-09 42961.</span>
<span class="co">#&gt; # … with 991 more rows</span></code></pre></div>
<p>The dataset is that is already set up for panel data modeling. The important columns are:</p>
<ul>
<li><p>“id”: This separates the time series groups (in this case these represent sales from departments in a walmart store)</p></li>
<li><p>“date”: This is the weekly sales period</p></li>
<li><p>“value”: This is the value for sales during the week and store/department</p></li>
</ul>
<p>We can visualize this by time series group to expose the differences in sales by department.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_tbl</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/plot_time_series.html">plot_time_series</a></span><span class="op">(</span>
    <span class="va">date</span>, <span class="va">value</span>, .interactive <span class="op">=</span> <span class="cn">F</span>, .facet_ncol <span class="op">=</span> <span class="fl">2</span>
  <span class="op">)</span></code></pre></div>
<p><img src="modeling-panel-data_files/figure-html/unnamed-chunk-9-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>We can clearly see that there are 7 time series groups with different weekly sales patterns.</p>
</div>
<div id="traintest-splitting" class="section level2">
<h2 class="hasAnchor">
<a href="#traintest-splitting" class="anchor"></a>Train/Test Splitting</h2>
<p>We can split the data into training and testing sets using <code><a href="https://rdrr.io/pkg/timetk/man/time_series_split.html">time_series_split()</a></code>. We’ll investigate the last 3-months of the year to test a global model on a 3-month forecast. The message on overlapping dates is to let us know that multiple time series are being processed using the last 3-month window for testing.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">splits</span> <span class="op">&lt;-</span> <span class="va">data_tbl</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/time_series_split.html">time_series_split</a></span><span class="op">(</span>
    assess     <span class="op">=</span> <span class="st">"3 months"</span>, 
    cumulative <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="co">#&gt; Using date_var: date</span>
<span class="co">#&gt; Data is not ordered by the 'date_var'. Resamples will be arranged by `date`.</span>
<span class="co">#&gt; Overlapping Timestamps Detected. Processing overlapping time series together using sliding windows.</span>

<span class="va">splits</span>
<span class="co">#&gt; &lt;Analysis/Assess/Total&gt;</span>
<span class="co">#&gt; &lt;917/84/1001&gt;</span></code></pre></div>
</div>
<div id="recipe" class="section level2">
<h2 class="hasAnchor">
<a href="#recipe" class="anchor"></a>Recipe</h2>
<p><strong>Next, we need to preprocess the data.</strong> This is where we add good features to imporve our global model performance. We will use the <code>recipes</code> workflow for generating time series features.</p>
<ul>
<li><p><code><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at()</a></code>: Applies a function to one or more columns. Used to remove extra unused levels in our categorical ID column.</p></li>
<li><p><code><a href="https://rdrr.io/pkg/timetk/man/step_timeseries_signature.html">step_timeseries_signature()</a></code>: Used to add calendar features based on our date column</p></li>
<li><p><code><a href="https://recipes.tidymodels.org/reference/step_rm.html">step_rm()</a></code>: Used to remove the date column. Machine Learning algorithms like XGBoost don’t handle date columns very well.</p></li>
<li><p><code><a href="https://recipes.tidymodels.org/reference/step_zv.html">step_zv()</a></code>: Used to remove any zero variance features. Features with no variance don’t add useful information to our model.</p></li>
<li><p><code><a href="https://recipes.tidymodels.org/reference/step_dummy.html">step_dummy()</a></code>: Used to convert categorical features to binary one-hot encoded features that algorithms like XGBoost can model more effectively.</p></li>
</ul>
<p>This results in 37 derived features for modeling. We can certainly include more features such as lags and rolling features that are known to improve results. These concepts and more are covered in the <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/">High-Performance Time Series Course</a>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rec_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">.</span>, <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">training</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_mutate_at.html">step_mutate_at</a></span><span class="op">(</span><span class="va">id</span>, fn <span class="op">=</span> <span class="va">droplevels</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/step_timeseries_signature.html">step_timeseries_signature</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_rm.html">step_rm</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_zv.html">step_zv</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_nominal_predictors</a></span><span class="op">(</span><span class="op">)</span>, one_hot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html">prep</a></span><span class="op">(</span><span class="va">rec_obj</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 38 × 4</span>
<span class="co">#&gt;    variable       type    role      source  </span>
<span class="co">#&gt;    &lt;chr&gt;          &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   </span>
<span class="co">#&gt;  1 value          numeric outcome   original</span>
<span class="co">#&gt;  2 date_index.num numeric predictor derived </span>
<span class="co">#&gt;  3 date_year      numeric predictor derived </span>
<span class="co">#&gt;  4 date_year.iso  numeric predictor derived </span>
<span class="co">#&gt;  5 date_half      numeric predictor derived </span>
<span class="co">#&gt;  6 date_quarter   numeric predictor derived </span>
<span class="co">#&gt;  7 date_month     numeric predictor derived </span>
<span class="co">#&gt;  8 date_month.xts numeric predictor derived </span>
<span class="co">#&gt;  9 date_day       numeric predictor derived </span>
<span class="co">#&gt; 10 date_mday      numeric predictor derived </span>
<span class="co">#&gt; # … with 28 more rows</span></code></pre></div>
</div>
<div id="machine-learning" class="section level2">
<h2 class="hasAnchor">
<a href="#machine-learning" class="anchor"></a>Machine Learning</h2>
<p>We’ll create an <code>xgboost</code> workflow by fitting the default xgboost model to our derived features from our in-sample training data set.</p>
<ul>
<li><p>Training the global xgboost model takes approximately 50 milliseconds.</p></li>
<li><p>Conversely, an ARIMA model might take several minutes to iterate through possible parameter combinations for each of the 7 time series.</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Workflow</span>
<span class="va">wflw_xgb</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">add_model</span><span class="op">(</span>
        <span class="fu"><a href="https://parsnip.tidymodels.org/reference/boost_tree.html">boost_tree</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"xgboost"</span><span class="op">)</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">add_recipe</span><span class="op">(</span><span class="va">rec_obj</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html">fit</a></span><span class="op">(</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">training</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span><span class="op">)</span>

<span class="va">wflw_xgb</span>
<span class="co">#&gt; ══ Workflow [trained] ══════════════════════════════════════════════════════════</span>
<span class="co">#&gt; Preprocessor: Recipe</span>
<span class="co">#&gt; Model: boost_tree()</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Preprocessor ────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; 5 Recipe Steps</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; • step_mutate_at()</span>
<span class="co">#&gt; • step_timeseries_signature()</span>
<span class="co">#&gt; • step_rm()</span>
<span class="co">#&gt; • step_zv()</span>
<span class="co">#&gt; • step_dummy()</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Model ───────────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt; ##### xgb.Booster</span>
<span class="co">#&gt; raw: 58.3 Kb </span>
<span class="co">#&gt; call:</span>
<span class="co">#&gt;   xgboost::xgb.train(params = list(eta = 0.3, max_depth = 6, gamma = 0, </span>
<span class="co">#&gt;     colsample_bytree = 1, colsample_bynode = 1, min_child_weight = 1, </span>
<span class="co">#&gt;     subsample = 1, objective = "reg:squarederror"), data = x$data, </span>
<span class="co">#&gt;     nrounds = 15, watchlist = x$watchlist, verbose = 0, nthread = 1)</span>
<span class="co">#&gt; params (as set within xgb.train):</span>
<span class="co">#&gt;   eta = "0.3", max_depth = "6", gamma = "0", colsample_bytree = "1", colsample_bynode = "1", min_child_weight = "1", subsample = "1", objective = "reg:squarederror", nthread = "1", validate_parameters = "TRUE"</span>
<span class="co">#&gt; xgb.attributes:</span>
<span class="co">#&gt;   niter</span>
<span class="co">#&gt; callbacks:</span>
<span class="co">#&gt;   cb.evaluation.log()</span>
<span class="co">#&gt; # of features: 37 </span>
<span class="co">#&gt; niter: 15</span>
<span class="co">#&gt; nfeatures : 37 </span>
<span class="co">#&gt; evaluation_log:</span>
<span class="co">#&gt;     iter training_rmse</span>
<span class="co">#&gt;        1     46315.141</span>
<span class="co">#&gt;        2     33001.734</span>
<span class="co">#&gt; ---                   </span>
<span class="co">#&gt;       14      3676.542</span>
<span class="co">#&gt;       15      3373.945</span></code></pre></div>
</div>
<div id="modeltime-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#modeltime-workflow" class="anchor"></a>Modeltime Workflow</h2>
<p>We’ll step through the modeltime workflow, which is used to test many different models on the time series and organize the entire process.</p>
<div class="figure" style="text-align: center">
<img src="modeltime_workflow.jpg" alt="Modeltime Workflow" width="100%"><p class="caption">
Modeltime Workflow
</p>
</div>
<div id="step-1-create-a-modeltime-table" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1-create-a-modeltime-table" class="anchor"></a>Step 1: Create a Modeltime Table</h3>
<p>The first step is to create a Modeltime Table with <code><a href="../reference/modeltime_table.html">modeltime_table()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modeltime_table.html">modeltime_table</a></span><span class="op">(</span>
    <span class="va">wflw_xgb</span>
<span class="op">)</span>

<span class="va">model_tbl</span>
<span class="co">#&gt; # Modeltime Table</span>
<span class="co">#&gt; # A tibble: 1 × 3</span>
<span class="co">#&gt;   .model_id .model     .model_desc</span>
<span class="co">#&gt;       &lt;int&gt; &lt;list&gt;     &lt;chr&gt;      </span>
<span class="co">#&gt; 1         1 &lt;workflow&gt; XGBOOST</span></code></pre></div>
</div>
<div id="step-2-calibrate-by-id" class="section level3">
<h3 class="hasAnchor">
<a href="#step-2-calibrate-by-id" class="anchor"></a>Step 2: Calibrate by ID</h3>
<p>Next, we need to calibrate, which calculates the forecast error on our test set. Use <code><a href="../reference/modeltime_calibrate.html">modeltime_calibrate()</a></code> to perform calibration. Note that when we add the <code>id</code>, we are able to track the the out-of-sample residual error by the “id” column.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">calib_tbl</span> <span class="op">&lt;-</span> <span class="va">model_tbl</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/modeltime_calibrate.html">modeltime_calibrate</a></span><span class="op">(</span>
      new_data <span class="op">=</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">testing</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span>, 
      id       <span class="op">=</span> <span class="st">"id"</span>
    <span class="op">)</span>

<span class="va">calib_tbl</span>
<span class="co">#&gt; # Modeltime Table</span>
<span class="co">#&gt; # A tibble: 1 × 5</span>
<span class="co">#&gt;   .model_id .model     .model_desc .type .calibration_data</span>
<span class="co">#&gt;       &lt;int&gt; &lt;list&gt;     &lt;chr&gt;       &lt;chr&gt; &lt;list&gt;           </span>
<span class="co">#&gt; 1         1 &lt;workflow&gt; XGBOOST     Test  &lt;tibble [84 × 5]&gt;</span></code></pre></div>
</div>
<div id="step-3-measure-test-accuracy" class="section level3">
<h3 class="hasAnchor">
<a href="#step-3-measure-test-accuracy" class="anchor"></a>Step 3: Measure Test Accuracy</h3>
<p>Next, we measure the global and local accuracy on the global model.</p>
<div id="global-accuracy" class="section level4">
<h4 class="hasAnchor">
<a href="#global-accuracy" class="anchor"></a>Global Accuracy</h4>
<p>The default is <code><a href="../reference/modeltime_accuracy.html">modeltime_accuracy(acc_by_id = FALSE)</a></code>, which returns a global model accuracy.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">calib_tbl</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/modeltime_accuracy.html">modeltime_accuracy</a></span><span class="op">(</span>acc_by_id <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/table_modeltime_accuracy.html">table_modeltime_accuracy</a></span><span class="op">(</span>.interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div id="pdtoabcoqx" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#pdtoabcoqx .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pdtoabcoqx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pdtoabcoqx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pdtoabcoqx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pdtoabcoqx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pdtoabcoqx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pdtoabcoqx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pdtoabcoqx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pdtoabcoqx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pdtoabcoqx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pdtoabcoqx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pdtoabcoqx .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#pdtoabcoqx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pdtoabcoqx .gt_from_md > :first-child {
  margin-top: 0;
}

#pdtoabcoqx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pdtoabcoqx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pdtoabcoqx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#pdtoabcoqx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pdtoabcoqx .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#pdtoabcoqx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pdtoabcoqx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pdtoabcoqx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pdtoabcoqx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pdtoabcoqx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pdtoabcoqx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#pdtoabcoqx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pdtoabcoqx .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#pdtoabcoqx .gt_left {
  text-align: left;
}

#pdtoabcoqx .gt_center {
  text-align: center;
}

#pdtoabcoqx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pdtoabcoqx .gt_font_normal {
  font-weight: normal;
}

#pdtoabcoqx .gt_font_bold {
  font-weight: bold;
}

#pdtoabcoqx .gt_font_italic {
  font-style: italic;
}

#pdtoabcoqx .gt_super {
  font-size: 65%;
}

#pdtoabcoqx .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="table gt_table">
<thead class="gt_header"><tr>
<th colspan="9" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Accuracy Table</th>
    </tr></thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.model_id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.model_desc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mae</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mase</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">smape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rmse</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rsq</th>
    </tr></thead>
<tbody class="gt_table_body"><tr>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">3254.56</td>
<td class="gt_row gt_right">7.19</td>
<td class="gt_row gt_right">0.1</td>
<td class="gt_row gt_right">7</td>
<td class="gt_row gt_right">4574.52</td>
<td class="gt_row gt_right">0.98</td>
</tr></tbody>
</table>
</div>
</div>
<div id="local-accuracy" class="section level4">
<h4 class="hasAnchor">
<a href="#local-accuracy" class="anchor"></a>Local Accuracy</h4>
<p>By toggling <code><a href="../reference/modeltime_accuracy.html">modeltime_accuracy(acc_by_id = TRUE)</a></code>, we can obtain the local model accuracy. This can be useful for identifying specifically which time series the model does well on (and which it does poorly on). We can then <strong>apply model selection logic</strong> to select specific global models for specific IDs.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">calib_tbl</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/modeltime_accuracy.html">modeltime_accuracy</a></span><span class="op">(</span>acc_by_id <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu"><a href="../reference/table_modeltime_accuracy.html">table_modeltime_accuracy</a></span><span class="op">(</span>.interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div id="bdqeqilhup" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#bdqeqilhup .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bdqeqilhup .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bdqeqilhup .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bdqeqilhup .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bdqeqilhup .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bdqeqilhup .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bdqeqilhup .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bdqeqilhup .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bdqeqilhup .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bdqeqilhup .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bdqeqilhup .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bdqeqilhup .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#bdqeqilhup .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bdqeqilhup .gt_from_md > :first-child {
  margin-top: 0;
}

#bdqeqilhup .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bdqeqilhup .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bdqeqilhup .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#bdqeqilhup .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bdqeqilhup .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#bdqeqilhup .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bdqeqilhup .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bdqeqilhup .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bdqeqilhup .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bdqeqilhup .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bdqeqilhup .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#bdqeqilhup .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bdqeqilhup .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#bdqeqilhup .gt_left {
  text-align: left;
}

#bdqeqilhup .gt_center {
  text-align: center;
}

#bdqeqilhup .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bdqeqilhup .gt_font_normal {
  font-weight: normal;
}

#bdqeqilhup .gt_font_bold {
  font-weight: bold;
}

#bdqeqilhup .gt_font_italic {
  font-style: italic;
}

#bdqeqilhup .gt_super {
  font-size: 65%;
}

#bdqeqilhup .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="table gt_table">
<thead class="gt_header"><tr>
<th colspan="10" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Accuracy Table</th>
    </tr></thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.model_id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.model_desc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mae</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mase</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">smape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rmse</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rsq</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_center">1_1</td>
<td class="gt_row gt_right">1138.25</td>
<td class="gt_row gt_right">6.19</td>
<td class="gt_row gt_right">0.85</td>
<td class="gt_row gt_right">5.93</td>
<td class="gt_row gt_right">1454.25</td>
<td class="gt_row gt_right">0.95</td>
</tr>
<tr>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_center">1_3</td>
<td class="gt_row gt_right">3403.81</td>
<td class="gt_row gt_right">18.47</td>
<td class="gt_row gt_right">0.57</td>
<td class="gt_row gt_right">16.96</td>
<td class="gt_row gt_right">4209.29</td>
<td class="gt_row gt_right">0.91</td>
</tr>
<tr>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_center">1_8</td>
<td class="gt_row gt_right">1891.35</td>
<td class="gt_row gt_right">4.93</td>
<td class="gt_row gt_right">0.86</td>
<td class="gt_row gt_right">5.07</td>
<td class="gt_row gt_right">2157.43</td>
<td class="gt_row gt_right">0.55</td>
</tr>
<tr>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_center">1_13</td>
<td class="gt_row gt_right">1201.11</td>
<td class="gt_row gt_right">2.92</td>
<td class="gt_row gt_right">0.53</td>
<td class="gt_row gt_right">2.97</td>
<td class="gt_row gt_right">1461.49</td>
<td class="gt_row gt_right">0.60</td>
</tr>
<tr>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_center">1_38</td>
<td class="gt_row gt_right">8036.27</td>
<td class="gt_row gt_right">10.52</td>
<td class="gt_row gt_right">0.99</td>
<td class="gt_row gt_right">10.64</td>
<td class="gt_row gt_right">8955.32</td>
<td class="gt_row gt_right">0.02</td>
</tr>
<tr>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_center">1_93</td>
<td class="gt_row gt_right">3493.69</td>
<td class="gt_row gt_right">4.50</td>
<td class="gt_row gt_right">0.34</td>
<td class="gt_row gt_right">4.64</td>
<td class="gt_row gt_right">4706.68</td>
<td class="gt_row gt_right">0.78</td>
</tr>
<tr>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_center">1_95</td>
<td class="gt_row gt_right">3617.45</td>
<td class="gt_row gt_right">2.83</td>
<td class="gt_row gt_right">0.46</td>
<td class="gt_row gt_right">2.83</td>
<td class="gt_row gt_right">4184.46</td>
<td class="gt_row gt_right">0.72</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="step-4-forecast-the-test-data" class="section level3">
<h3 class="hasAnchor">
<a href="#step-4-forecast-the-test-data" class="anchor"></a>Step 4: Forecast the Test Data</h3>
<p>Next, we need to forecast the test dataset. This is useful to evaluate the model using a sampling of the time series within the panel dataset. We use <code><a href="../reference/modeltime_forecast.html">modeltime_forecast(conf_by_id  = TRUE)</a></code> to allow the confidence intervals (prediction intervals) to be calculated by time series identifier. Note, that the <code><a href="../reference/modeltime_calibrate.html">modeltime_calibrate()</a></code> must have been performed with an <code>id</code> specified.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">calib_tbl</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/modeltime_forecast.html">modeltime_forecast</a></span><span class="op">(</span>
        new_data    <span class="op">=</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">testing</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span>,
        actual_data <span class="op">=</span> <span class="va">data_tbl</span>,
        conf_by_id  <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="../reference/plot_modeltime_forecast.html">plot_modeltime_forecast</a></span><span class="op">(</span>
        .facet_ncol  <span class="op">=</span> <span class="fl">3</span>,
        .interactive <span class="op">=</span> <span class="cn">FALSE</span>
    <span class="op">)</span></code></pre></div>
<p><img src="modeling-panel-data_files/figure-html/unnamed-chunk-18-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div id="step-5-refit-and-forecast-the-future" class="section level3">
<h3 class="hasAnchor">
<a href="#step-5-refit-and-forecast-the-future" class="anchor"></a>Step 5: Refit and Forecast the Future</h3>
<p>We see that our global model performs well on this dataset. Now, we will forecast the future.</p>
<div id="refit-the-models" class="section level4">
<h4 class="hasAnchor">
<a href="#refit-the-models" class="anchor"></a>Refit the Models</h4>
<p>The refitting step is needed to incorporate the most recent information into our models. We use <code><a href="../reference/modeltime_refit.html">modeltime_refit()</a></code> to update the model(s) in our modeltime tables.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">refit_tbl</span> <span class="op">&lt;-</span> <span class="va">calib_tbl</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/modeltime_refit.html">modeltime_refit</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_tbl</span><span class="op">)</span>

<span class="va">refit_tbl</span>
<span class="co">#&gt; # Modeltime Table</span>
<span class="co">#&gt; # A tibble: 1 × 5</span>
<span class="co">#&gt;   .model_id .model     .model_desc .type .calibration_data</span>
<span class="co">#&gt;       &lt;int&gt; &lt;list&gt;     &lt;chr&gt;       &lt;chr&gt; &lt;list&gt;           </span>
<span class="co">#&gt; 1         1 &lt;workflow&gt; XGBOOST     Test  &lt;tibble [84 × 5]&gt;</span></code></pre></div>
</div>
<div id="future-data" class="section level4">
<h4 class="hasAnchor">
<a href="#future-data" class="anchor"></a>Future Data</h4>
<p>Next, make a future dataset using <code><a href="https://rdrr.io/pkg/timetk/man/future_frame.html">future_frame()</a></code> from <code>timetk</code>, which creates future time stamps that extend 52-weeks into the future for each ID in the same panel structure needed for our global forecast model.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">future_tbl</span> <span class="op">&lt;-</span> <span class="va">data_tbl</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/timetk/man/future_frame.html">future_frame</a></span><span class="op">(</span>.length_out <span class="op">=</span> <span class="fl">52</span>, .bind_data <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">future_tbl</span>
<span class="co">#&gt; # A tibble: 364 × 2</span>
<span class="co">#&gt; # Groups:   id [7]</span>
<span class="co">#&gt;    id    date      </span>
<span class="co">#&gt;    &lt;fct&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1 1_1   2012-11-02</span>
<span class="co">#&gt;  2 1_1   2012-11-09</span>
<span class="co">#&gt;  3 1_1   2012-11-16</span>
<span class="co">#&gt;  4 1_1   2012-11-23</span>
<span class="co">#&gt;  5 1_1   2012-11-30</span>
<span class="co">#&gt;  6 1_1   2012-12-07</span>
<span class="co">#&gt;  7 1_1   2012-12-14</span>
<span class="co">#&gt;  8 1_1   2012-12-21</span>
<span class="co">#&gt;  9 1_1   2012-12-28</span>
<span class="co">#&gt; 10 1_1   2013-01-04</span>
<span class="co">#&gt; # … with 354 more rows</span></code></pre></div>
</div>
<div id="future-predictions" class="section level4">
<h4 class="hasAnchor">
<a href="#future-predictions" class="anchor"></a>Future Predictions</h4>
<p>Finally, we can forecast the future using our future data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">refit_tbl</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/modeltime_forecast.html">modeltime_forecast</a></span><span class="op">(</span>
    new_data    <span class="op">=</span> <span class="va">future_tbl</span>,
    actual_data <span class="op">=</span> <span class="va">data_tbl</span>, 
    conf_by_id  <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/plot_modeltime_forecast.html">plot_modeltime_forecast</a></span><span class="op">(</span>
    .interactive <span class="op">=</span> <span class="cn">F</span>,
    .facet_ncol  <span class="op">=</span> <span class="fl">2</span>
  <span class="op">)</span></code></pre></div>
<p><img src="modeling-panel-data_files/figure-html/unnamed-chunk-21-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
</div>
<div id="summary" class="section level1">
<h1 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h1>
<p>We’ve now successfully completed a <strong>Global Forecast.</strong> You may find this challenging, especially if you are not familiar with the Modeltime Workflow, terminology, or tidymodeling in R. If this is the case, we have a solution. Take our high-performance forecasting course.</p>
<div id="take-the-high-performance-forecasting-course" class="section level2">
<h2 class="hasAnchor">
<a href="#take-the-high-performance-forecasting-course" class="anchor"></a>Take the High-Performance Forecasting Course</h2>
<blockquote>
<p>Become the forecasting expert for your organization</p>
</blockquote>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/" target="_blank"><img src="https://www.filepicker.io/api/file/bKyqVAi5Qi64sS05QYLk" alt="High-Performance Time Series Forecasting Course" width="100%" style="box-shadow: 0 0 5px 2px rgba(0, 0, 0, .5);"></a></p>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/"><em>High-Performance Time Series Course</em></a></p>
<div id="time-series-is-changing" class="section level3">
<h3 class="hasAnchor">
<a href="#time-series-is-changing" class="anchor"></a>Time Series is Changing</h3>
<p>Time series is changing. <strong>Businesses now need 10,000+ time series forecasts every day.</strong> This is what I call a <em>High-Performance Time Series Forecasting System (HPTSF)</em> - Accurate, Robust, and Scalable Forecasting.</p>
<p><strong>High-Performance Forecasting Systems will save companies by improving accuracy and scalability.</strong> Imagine what will happen to your career if you can provide your organization a “High-Performance Time Series Forecasting System” (HPTSF System).</p>
</div>
<div id="how-to-learn-high-performance-time-series-forecasting" class="section level3">
<h3 class="hasAnchor">
<a href="#how-to-learn-high-performance-time-series-forecasting" class="anchor"></a>How to Learn High-Performance Time Series Forecasting</h3>
<p>I teach how to build a HPTFS System in my <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting"><strong>High-Performance Time Series Forecasting Course</strong></a>. You will learn:</p>
<ul>
<li>
<strong>Time Series Machine Learning</strong> (cutting-edge) with <code>Modeltime</code> - 30+ Models (Prophet, ARIMA, XGBoost, Random Forest, &amp; many more)</li>
<li>
<strong>Deep Learning</strong> with <code>GluonTS</code> (Competition Winners)</li>
<li>
<strong>Time Series Preprocessing</strong>, Noise Reduction, &amp; Anomaly Detection</li>
<li>
<strong>Feature engineering</strong> using lagged variables &amp; external regressors</li>
<li><strong>Hyperparameter Tuning</strong></li>
<li><strong>Time series cross-validation</strong></li>
<li>
<strong>Ensembling</strong> Multiple Machine Learning &amp; Univariate Modeling Techniques (Competition Winner)</li>
<li>
<strong>Scalable Forecasting</strong> - Forecast 1000+ time series in parallel</li>
<li>and more.</li>
</ul>
<p class="text-center" style="font-size:24px;">
Become the Time Series Expert for your organization.
</p>
<br><p class="text-center" style="font-size:30px;">
<a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting">Take the High-Performance Time Series Forecasting Course</a>
</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Dancho.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
