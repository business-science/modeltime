<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The goal of modeltime_forecast() is to simplify the process of
forecasting future data."><title>Forecast future data — modeltime_forecast • modeltime</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Forecast future data — modeltime_forecast"><meta property="og:description" content="The goal of modeltime_forecast() is to simplify the process of
forecasting future data."><meta property="og:image" content="https://business-science.github.io/modeltime/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-20GDZ5LL77"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-20GDZ5LL77');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">modeltime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.8.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/getting-started-with-modeltime.html">Start</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Getting Started</h6>
    <a class="dropdown-item" href="../articles/getting-started-with-modeltime.html">Getting Started with Modeltime</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Forecasting Many Time Series (Scale)</h6>
    <a class="dropdown-item" href="../articles/modeling-panel-data.html">Global Model Forecasting</a>
    <a class="dropdown-item" href="../articles/nested-forecasting.html">Iterative (Nested) Forecasting</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6>
    <a class="dropdown-item" href="../articles/modeltime-conformal-prediction.html">Conformal Prediction Interval Forecasting</a>
    <a class="dropdown-item" href="../articles/recursive-forecasting.html">Autoregressive (Recursive) Forecasting</a>
    <a class="dropdown-item" href="../articles/parallel-processing.html">Hyperparameter Tuning &amp; Parallel Processing</a>
    <a class="dropdown-item" href="../articles/modeltime-spark.html">The Modeltime Spark Backend</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Algorithms</h6>
    <a class="dropdown-item" href="../articles/modeltime-model-list.html">Modeltime Algorithm Roadmap</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Developers</h6>
    <a class="dropdown-item" href="../articles/extending-modeltime.html">Extending Modeltime (Developer Tools)</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-api">API</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-api">
    <h6 class="dropdown-header" data-toc-skip>API Functions</h6>
    <a class="dropdown-item" href="../reference/index.html">
      <span class="fa fa-home"></span>
       
      Function Reference
    </a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Change History</h6>
    <a class="dropdown-item" href="../news/index.html">News</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-r-ecosystem">R Ecosystem</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-r-ecosystem">
    <h6 class="dropdown-header" data-toc-skip>Forecast</h6>
    <a class="dropdown-item" href="https://business-science.github.io/modeltime/">Modeltime (Forecasting)</a>
    <a class="external-link dropdown-item" href="https://business-science.github.io/timetk/">TimeTK (Time Series Analysis)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Improve</h6>
    <a class="dropdown-item" href="https://business-science.github.io/modeltime.ensemble/">Modeltime Ensemble (Blending Forecasts)</a>
    <a class="dropdown-item" href="https://business-science.github.io/modeltime.resample/">Modeltime Resample (Backtesting)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Scale</h6>
    <a class="dropdown-item" href="https://business-science.github.io/modeltime.h2o/">Modeltime H2O (AutoML)</a>
    <a class="dropdown-item" href="https://business-science.github.io/modeltime.gluonts/">Modeltime GluonTS (Deep Learning)</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-python">Python</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-python">
    <h6 class="dropdown-header" data-toc-skip>Forecast</h6>
    <a class="external-link dropdown-item" href="https://business-science.github.io/pytimetk/">Timetk for Python (Time Series Analysis)</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/">
    <span class="fas fa fas fa-graduation-cap"></span>
     
    Learn
  </a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/business-science/modeltime">
    <span class="fab fa fab fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Forecast future data</h1>
      <small class="dont-index">Source: <a href="https://github.com/business-science/modeltime/blob/master/R/modeltime-forecast.R" class="external-link"><code>R/modeltime-forecast.R</code></a></small>
      <div class="d-none name"><code>modeltime_forecast.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The goal of <code>modeltime_forecast()</code> is to simplify the process of
forecasting future data.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">modeltime_forecast</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  new_data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  h <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  actual_data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  conf_interval <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  conf_by_id <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  conf_method <span class="op">=</span> <span class="st">"conformal_default"</span>,</span>
<span>  keep_data <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  arrange_index <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>A Modeltime Table</p></dd>


<dt>new_data</dt>
<dd><p>A <code>tibble</code> containing future information to forecast.
If <code>NULL</code>, forecasts the calibration data.</p></dd>


<dt>h</dt>
<dd><p>The forecast horizon (can be used instead of <code>new_data</code> for
time series with no exogenous regressors).
Extends the calibration data <code>h</code> periods into the future.</p></dd>


<dt>actual_data</dt>
<dd><p>Reference data that is combined with the output tibble and given a <code>.key = "actual"</code></p></dd>


<dt>conf_interval</dt>
<dd><p>An estimated confidence interval based on the calibration data.
This is designed to estimate future confidence from <em>out-of-sample prediction error</em>.</p></dd>


<dt>conf_by_id</dt>
<dd><p>Whether or not to produce confidence interval estimates by an ID feature.</p><ul><li><p>When <code>FALSE</code>, a global model confidence interval is provided.</p></li>
<li><p>If <code>TRUE</code>, a local confidence interval is provided group-wise for each time series ID.
To enable local confidence interval, an <code>id</code> must be provided during <code><a href="modeltime_calibrate.html">modeltime_calibrate()</a></code>.</p></li>
</ul></dd>


<dt>conf_method</dt>
<dd><p>Algorithm used to produce confidence intervals. All CI's are Conformal Predictions. Choose one of:</p><ul><li><p><code>conformal_default</code>: Uses <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm()</a></code> to compute quantiles from out-of-sample (test set) residuals.</p></li>
<li><p><code>conformal_split</code>: Uses the split method split conformal inference method described by Lei <em>et al</em> (2018)</p></li>
</ul></dd>


<dt>keep_data</dt>
<dd><p>Whether or not to keep the <code>new_data</code> and <code>actual_data</code> as extra columns in the results.
This can be useful if there is an important feature in the <code>new_data</code> and <code>actual_data</code> needed
when forecasting.
Default: <code>FALSE</code>.</p></dd>


<dt>arrange_index</dt>
<dd><p>Whether or not to sort the index in rowwise chronological order (oldest to newest) or to
keep the original order of the data.
Default: <code>FALSE</code>.</p></dd>


<dt>...</dt>
<dd><p>Not currently used</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A tibble with predictions and time-stamp data. For ease of plotting and calculations,
the column names are transformed to:</p><ul><li><p><code>.key</code>: Values labeled either "prediction" or "actual"</p></li>
<li><p><code>.index</code>: The timestamp index.</p></li>
<li><p><code>.value</code>: The value being forecasted.</p></li>
</ul><p>Additionally, if the Modeltime Table has been previously calibrated using <code><a href="modeltime_calibrate.html">modeltime_calibrate()</a></code>,
you will gain confidence intervals.</p><ul><li><p><code>.conf_lo</code>: The lower limit of the confidence interval.</p></li>
<li><p><code>.conf_hi</code>: The upper limit of the confidence interval.</p></li>
</ul><p>Additional descriptive columns are included:</p><ul><li><p><code>.model_id</code>: Model ID from the Modeltime Table</p></li>
<li><p><code>.model_desc</code>: Model Description from the Modeltime Table</p></li>
</ul><p>Unnecessary columns are <em>dropped</em> to save space:</p><ul><li><p><code>.model</code></p></li>
<li><p><code>.calibration_data</code></p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>modeltime_forecast()</code> function prepares a forecast for visualization with
with <code><a href="plot_modeltime_forecast.html">plot_modeltime_forecast()</a></code>. The forecast is controlled by <code>new_data</code> or <code>h</code>,
which can be combined with existing data (controlled by <code>actual_data</code>).
Confidence intervals are included if the incoming Modeltime Table has been
calibrated using <code><a href="modeltime_calibrate.html">modeltime_calibrate()</a></code>.
Otherwise confidence intervals are not estimated.</p>
<p><strong>New Data</strong></p>
<p>When forecasting you can specify future data using <code>new_data</code>.
This is a future tibble with date column and columns for xregs
extending the trained dates and exogonous regressors (xregs) if used.</p><ul><li><p><strong>Forecasting Evaluation Data</strong>: By default, the <code>new_data</code> will use the <code>.calibration_data</code>
if <code>new_data</code> is not provided.
This is the equivalent of using <code><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">rsample::testing()</a></code> for getting test data sets.</p></li>
<li><p><strong>Forecasting Future Data</strong>: See <code><a href="https://rdrr.io/pkg/timetk/man/future_frame.html" class="external-link">timetk::future_frame()</a></code> for creating future tibbles.</p></li>
<li><p><strong>Xregs</strong>: Can be used with this method</p></li>
</ul><p><strong>H (Horizon)</strong></p>
<p>When forecasting, you can specify <code>h</code>. This is a phrase like "1 year",
which extends the <code>.calibration_data</code> (1st priority) or the <code>actual_data</code> (2nd priority)
into the future.</p><ul><li><p><strong>Forecasting Future Data</strong>: All forecasts using <code>h</code> are
<em><strong>extended after the calibration data or actual_data</strong></em>.</p></li>
<li><p>Extending <code>.calibration_data</code> - Calibration data is given 1st priority, which is
desirable <em>after refitting</em> with <code><a href="modeltime_refit.html">modeltime_refit()</a></code>.
Internally, a call is made to <code><a href="https://rdrr.io/pkg/timetk/man/future_frame.html" class="external-link">timetk::future_frame()</a></code> to
expedite creating new data using the date feature.</p></li>
<li><p>Extending <code>actual_data</code> - If <code>h</code> is provided, and the modeltime table has not been
calibrated, the "actual_data" will be extended into the future. This is useful
in situations where you want to go directly from <code><a href="modeltime_table.html">modeltime_table()</a></code> to <code>modeltime_forecast()</code>
without calibrating or refitting.</p></li>
<li><p><strong>Xregs</strong>: Cannot be used because future data must include new xregs.
If xregs are desired, build a future data frame and use <code>new_data</code>.</p></li>
</ul><p><strong>Actual Data</strong></p>
<p>This is reference data that contains the true values of the time-stamp data.
It helps in visualizing the performance of the forecast vs the actual data.</p>
<p>When <code>h</code> is used and the Modeltime Table has <em>not been calibrated</em>, then the
actual data is extended into the future periods that are defined by <code>h</code>.</p>
<p><strong>Confidence Interval Estimation</strong></p>
<p>Confidence intervals (<code>.conf_lo</code>, <code>.conf_hi</code>) are estimated based on the normal estimation of
the testing errors (out of sample) from <code><a href="modeltime_calibrate.html">modeltime_calibrate()</a></code>.
The out-of-sample error estimates are then carried through and
applied to applied to any future forecasts.</p>
<p>The confidence interval can be adjusted with the <code>conf_interval</code> parameter. The algorithm used
to produce confidence intervals can be changed with the <code>conf_method</code> parameter.</p>
<p><em>Conformal Default Method:</em></p>
<p>When <code>conf_method = "conformal_default"</code> (default), this method uses <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm()</a></code>
to produce a 95% confidence interval by default. It estimates a normal (Gaussian distribution)
based on the out-of-sample errors (residuals).</p>
<p>The confidence interval is <em>mean-adjusted</em>, meaning that if the mean of the residuals
is non-zero, the confidence interval is adjusted to widen the interval to capture
the difference in means.</p>
<p><em>Conformal Split Method:</em></p>
<p>When <code>conf_method = "conformal_split</code>, this method uses the split conformal inference method
described by Lei <em>et al</em> (2018). This is also implemented in the <code>probably</code> R package's
<code>int_conformal_split()</code> function.</p>
<p><em>What happens to the confidence interval after refitting models?</em></p>
<p>Refitting has no affect on the confidence interval since this is calculated independently of
the refitted model. New observations typically improve
future accuracy, which in most cases makes the out-of-sample confidence intervals conservative.</p>
<p><strong>Keep Data</strong></p>
<p>Include the new data (and actual data) as extra columns with the results of the model forecasts.
This can be helpful when the new data includes information useful to the forecasts.
An example is when forecasting <em>Panel Data</em> and the new data contains
ID features related to the time series group that the forecast belongs to.</p>
<p><strong>Arrange Index</strong></p>
<p>By default, <code>modeltime_forecast()</code> keeps the original order of the data.
If desired, the user can sort the output by <code>.key</code>, <code>.model_id</code> and <code>.index</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Lei, Jing, et al. "Distribution-free predictive inference for regression."
<em>Journal of the American Statistical Association</em> 113.523 (2018): 1094-1111.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/timetk" class="external-link">timetk</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org" class="external-link">rsample</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Data</span></span></span>
<span class="r-in"><span><span class="va">m750</span> <span class="op">&lt;-</span> <span class="va">m4_monthly</span> <span class="op"><a href="pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="st">"M750"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Split Data 80/20</span></span></span>
<span class="r-in"><span><span class="va">splits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">initial_time_split</a></span><span class="op">(</span><span class="va">m750</span>, prop <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># --- MODELS ---</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Model 1: prophet ----</span></span></span>
<span class="r-in"><span><span class="va">model_fit_prophet</span> <span class="op">&lt;-</span> <span class="fu"><a href="prophet_reg.html">prophet_reg</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span>engine <span class="op">=</span> <span class="st">"prophet"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">date</span>, data <span class="op">=</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">training</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Disabling weekly seasonality. Run prophet with weekly.seasonality=TRUE to override this.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Disabling daily seasonality. Run prophet with daily.seasonality=TRUE to override this.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- MODELTIME TABLE ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">models_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="modeltime_table.html">modeltime_table</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">model_fit_prophet</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- CALIBRATE ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">calibration_tbl</span> <span class="op">&lt;-</span> <span class="va">models_tbl</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="modeltime_calibrate.html">modeltime_calibrate</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- ACCURACY ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">calibration_tbl</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="modeltime_accuracy.html">modeltime_accuracy</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 × 9</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   .model_id .model_desc .type   mae  mape  mase smape  rmse   rsq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>         1 PROPHET     Test   178.  1.70 0.609  1.71  235. 0.880</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- FUTURE FORECAST ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">calibration_tbl</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu">modeltime_forecast</span><span class="op">(</span></span></span>
<span class="r-in"><span>        new_data    <span class="op">=</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        actual_data <span class="op">=</span> <span class="va">m750</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # Forecast Results</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Conf Method: conformal_default | Conf Interval: 0.95 | Conf By ID: FALSE</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">(GLOBAL CONFIDENCE)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 337 × 7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    .model_id .model_desc .key   .index     .value .conf_lo .conf_hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-01-01   <span style="text-decoration: underline;">6</span>370       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-02-01   <span style="text-decoration: underline;">6</span>430       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-03-01   <span style="text-decoration: underline;">6</span>520       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-04-01   <span style="text-decoration: underline;">6</span>580       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-05-01   <span style="text-decoration: underline;">6</span>620       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-06-01   <span style="text-decoration: underline;">6</span>690       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-07-01   <span style="text-decoration: underline;">6</span>000       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-08-01   <span style="text-decoration: underline;">5</span>450       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-09-01   <span style="text-decoration: underline;">6</span>480       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-10-01   <span style="text-decoration: underline;">6</span>820       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 327 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- ALTERNATIVE: FORECAST WITHOUT CONFIDENCE INTERVALS ----</span></span></span>
<span class="r-in"><span><span class="co"># Skips Calibration Step, No Confidence Intervals</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">models_tbl</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu">modeltime_forecast</span><span class="op">(</span></span></span>
<span class="r-in"><span>        new_data    <span class="op">=</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        actual_data <span class="op">=</span> <span class="va">m750</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # Forecast Results</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Conf Method: conformal_default | Conf Interval: | Conf By ID: FALSE (GLOBAL</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">CONFIDENCE)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 337 × 5</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    .model_id .model_desc .key   .index     .value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-01-01   <span style="text-decoration: underline;">6</span>370</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-02-01   <span style="text-decoration: underline;">6</span>430</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-03-01   <span style="text-decoration: underline;">6</span>520</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-04-01   <span style="text-decoration: underline;">6</span>580</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-05-01   <span style="text-decoration: underline;">6</span>620</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-06-01   <span style="text-decoration: underline;">6</span>690</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-07-01   <span style="text-decoration: underline;">6</span>000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-08-01   <span style="text-decoration: underline;">5</span>450</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-09-01   <span style="text-decoration: underline;">6</span>480</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>        <span style="color: #BB0000;">NA</span> ACTUAL      actual 1990-10-01   <span style="text-decoration: underline;">6</span>820</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 327 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- KEEP NEW DATA WITH FORECAST ----</span></span></span>
<span class="r-in"><span><span class="co"># Keeps the new data. Useful if new data has information</span></span></span>
<span class="r-in"><span><span class="co">#  like ID features that should be kept with the forecast data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">calibration_tbl</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>    <span class="fu">modeltime_forecast</span><span class="op">(</span></span></span>
<span class="r-in"><span>        new_data      <span class="op">=</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html" class="external-link">testing</a></span><span class="op">(</span><span class="va">splits</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        keep_data     <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> # Forecast Results</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">Conf Method: conformal_default | Conf Interval: 0.95 | Conf By ID: FALSE</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #555555;">(GLOBAL CONFIDENCE)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 31 × 10</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    .model_id .model_desc .key       .index     .value .conf_lo .conf_hi id   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>         1 PROPHET     prediction 2012-12-01 <span style="text-decoration: underline;">10</span>596.   <span style="text-decoration: underline;">10</span>131.   <span style="text-decoration: underline;">11</span>061. M750 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>         1 PROPHET     prediction 2013-01-01 <span style="text-decoration: underline;">10</span>508.   <span style="text-decoration: underline;">10</span>043.   <span style="text-decoration: underline;">10</span>973. M750 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>         1 PROPHET     prediction 2013-02-01 <span style="text-decoration: underline;">10</span>550.   <span style="text-decoration: underline;">10</span>086.   <span style="text-decoration: underline;">11</span>015. M750 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>         1 PROPHET     prediction 2013-03-01 <span style="text-decoration: underline;">10</span>684.   <span style="text-decoration: underline;">10</span>220.   <span style="text-decoration: underline;">11</span>149. M750 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>         1 PROPHET     prediction 2013-04-01 <span style="text-decoration: underline;">10</span>714.   <span style="text-decoration: underline;">10</span>249.   <span style="text-decoration: underline;">11</span>179. M750 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>         1 PROPHET     prediction 2013-05-01 <span style="text-decoration: underline;">10</span>716.   <span style="text-decoration: underline;">10</span>251.   <span style="text-decoration: underline;">11</span>181. M750 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>         1 PROPHET     prediction 2013-06-01 <span style="text-decoration: underline;">10</span>556.   <span style="text-decoration: underline;">10</span>092.   <span style="text-decoration: underline;">11</span>021. M750 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>         1 PROPHET     prediction 2013-07-01  <span style="text-decoration: underline;">9</span>678.    <span style="text-decoration: underline;">9</span>213.   <span style="text-decoration: underline;">10</span>143. M750 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>         1 PROPHET     prediction 2013-08-01  <span style="text-decoration: underline;">9</span>530.    <span style="text-decoration: underline;">9</span>065.    <span style="text-decoration: underline;">9</span>995. M750 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>         1 PROPHET     prediction 2013-09-01 <span style="text-decoration: underline;">10</span>158.    <span style="text-decoration: underline;">9</span>693.   <span style="text-decoration: underline;">10</span>623. M750 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 21 more rows</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2 more variables: date &lt;date&gt;, value &lt;dbl&gt;</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Matt Dancho.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

