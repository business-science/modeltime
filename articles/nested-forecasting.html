<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="modeltime">
<title>Nested Forecasting • modeltime</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Nested Forecasting">
<meta property="og:description" content="modeltime">
<meta property="og:image" content="https://business-science.github.io/modeltime/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-76139189-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-76139189-2');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">modeltime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/getting-started-with-modeltime.html">Getting Started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Getting Started</h6>
    <a class="dropdown-item" href="../articles/getting-started-with-modeltime.html">Getting Started with Modeltime</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Forecasting Many Time Series (Scale)</h6>
    <a class="dropdown-item" href="../articles/modeling-panel-data.html">Global Model Forecasting</a>
    <a class="dropdown-item" href="../articles/nested-forecasting.html">Iterative (Nested) Forecasting</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Advanced Topics</h6>
    <a class="dropdown-item" href="../articles/recursive-forecasting.html">Autoregressive (Recursive) Forecasting</a>
    <a class="dropdown-item" href="../articles/parallel-processing.html">Hyperparameter Tuning &amp; Parallel Processing</a>
    <a class="dropdown-item" href="../articles/modeltime-spark.html">The Modeltime Spark Backend</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Algorithms</h6>
    <a class="dropdown-item" href="../articles/modeltime-model-list.html">Modeltime Algorithm Roadmap</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Developers</h6>
    <a class="dropdown-item" href="../articles/extending-modeltime.html">Extending Modeltime (Developer Tools)</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-api">API</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-api">
    <h6 class="dropdown-header" data-toc-skip>API Functions</h6>
    <a class="dropdown-item" href="../reference/index.html">
      <span class="fa fa-home"></span>
       
      Function Reference
    </a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Change History</h6>
    <a class="dropdown-item" href="../news/index.html">News</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-ecosystem">Ecosystem</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-ecosystem">
    <h6 class="dropdown-header" data-toc-skip>Forecast</h6>
    <a class="dropdown-item" href="https://business-science.github.io/modeltime/">Modeltime (Forecasting)</a>
    <a class="external-link dropdown-item" href="https://business-science.github.io/timetk/">TimeTK (Time Series Analysis)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Improve</h6>
    <a class="dropdown-item" href="https://business-science.github.io/modeltime.ensemble/">Modeltime Ensemble (Blending Forecasts)</a>
    <a class="dropdown-item" href="https://business-science.github.io/modeltime.resample/">Modeltime Resample (Backtesting)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Scale</h6>
    <a class="dropdown-item" href="https://business-science.github.io/modeltime.h2o/">Modeltime H2O (AutoML)</a>
    <a class="dropdown-item" href="https://business-science.github.io/modeltime.gluonts/">Modeltime GluonTS (Deep Learning)</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/">
    <span class="fas fa fas fa-graduation-cap"></span>
     
    Learn
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/business-science/modeltime">
    <span class="fab fa fab fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="nested-forecasting_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Nested Forecasting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/business-science/modeltime/blob/master/vignettes/nested-forecasting.Rmd" class="external-link"><code>vignettes/nested-forecasting.Rmd</code></a></small>
      <div class="d-none name"><code>nested-forecasting.Rmd</code></div>
    </div>

    
    
<blockquote>
<p>Iteratively forecast with nested modeling</p>
</blockquote>
<p><strong>Why is nested forecasting important?</strong> For starters, the ability to <em>iteratively forecast</em> time series with many models that are trained on many individual groups has been a huge request from students in our <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/" class="external-link">Time Series Course</a>. Why? Because two methods exist that get results:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Global Modeling:</strong> Best for scalability using a Global Models and a Panel Data structure. See <a href="https://business-science.github.io/modeltime/articles/modeling-panel-data.html">Forecasting with Global Models</a>.</p></li>
<li><p><strong>Iterative Forecasting:</strong> Best for accuracy using a Nested Data Structure. Takes longer than global model (more resources due to for-loop iteration), but can yield great results.</p></li>
</ol>
<p>We’ve incorporated a new approach called <strong><em>“nested forecasting”</em></strong> to help perform <em>Iterative Forecasting</em>.</p>
<div class="section level2">
<h2 id="nested-forecasting">Nested Forecasting<a class="anchor" aria-label="anchor" href="#nested-forecasting"></a>
</h2>
<p>The core idea of <strong>nested forecasting</strong> is to convert a dataset containing <strong>many time series groups</strong> into a nested data set, then fit <strong>many models</strong> to each of the nested datasets. The result is an iterative forecasting process that generates Nested Modeltime Tables with all of the forecast attributes needed to make decisions.</p>
<p><img src="modeltime-nested.jpg" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="important-concepts-logging-attributes">Important Concepts: Logging &amp; Attributes<a class="anchor" aria-label="anchor" href="#important-concepts-logging-attributes"></a>
</h2>
<p>A new feature to nested forecasting workflow is <strong>logged attributes</strong>, which is very useful in complex workflows where loops (iteration) is performed. In a <em>Nested Modeltime Table</em>, we push as many operations as possible into the fitting and refitting stages, logging important aspects including:</p>
<ul>
<li>
<strong>Test Accuracy:</strong> <code><a href="../reference/log_extractors.html">extract_nested_test_accuracy()</a></code>
</li>
<li>
<strong>Test Forecast:</strong> <code><a href="../reference/log_extractors.html">extract_nested_test_forecast()</a></code>
</li>
<li>
<strong>Error Reports:</strong> <code><a href="../reference/log_extractors.html">extract_nested_error_report()</a></code>
</li>
<li>
<strong>Best Models:</strong> <code><a href="../reference/log_extractors.html">extract_nested_best_model_report()</a></code>
</li>
<li>
<strong>Future Forecasts:</strong> <code><a href="../reference/log_extractors.html">extract_nested_future_forecast()</a></code>
</li>
</ul>
<p>While this deviates from the traditional Modeltime Workflow, we find that <strong>logging vastly speeds up experimentation and information retrieval</strong> especially when the number of time series increases.</p>
<p><img src="nested-logs.jpg" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h2>
<p>We’ll go through a short tutorial on <strong>Nested Forecasting.</strong> The first thing to do is to load the following libraries:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/modeltime" class="external-link">modeltime</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/timetk" class="external-link">timetk</a></span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h3>
<p>Next, let’s use the <code>walmart_sales_weekly</code> dataset that comes with <code>timetk</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_tbl</span> <span class="op">&lt;-</span> <span class="va">walmart_sales_weekly</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">Date</span>, <span class="va">Weekly_Sales</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"date"</span>, <span class="st">"value"</span><span class="op">)</span><span class="op">)</span>

<span class="va">data_tbl</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,001 × 3</span></span>
<span class="co">#&gt;    id    date        value</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1_1   2010-02-05 <span style="text-decoration: underline;">24</span>924.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1_1   2010-02-12 <span style="text-decoration: underline;">46</span>039.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1_1   2010-02-19 <span style="text-decoration: underline;">41</span>596.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1_1   2010-02-26 <span style="text-decoration: underline;">19</span>404.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1_1   2010-03-05 <span style="text-decoration: underline;">21</span>828.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1_1   2010-03-12 <span style="text-decoration: underline;">21</span>043.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1_1   2010-03-19 <span style="text-decoration: underline;">22</span>137.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1_1   2010-03-26 <span style="text-decoration: underline;">26</span>229.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1_1   2010-04-02 <span style="text-decoration: underline;">57</span>258.</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1_1   2010-04-09 <span style="text-decoration: underline;">42</span>961.</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 991 more rows</span></span></code></pre></div>
<p>The problem with this dataset is that it’s set up for panel data modeling. The important columns are:</p>
<ul>
<li><p>“id”: This separates the time series groups (in this case these represent sales from departments in a walmart store)</p></li>
<li><p>“date”: This is the weekly sales period</p></li>
<li><p>“value”: This is the value for sales during the week and store/department</p></li>
</ul>
<p>We can visualize this by time series group to expose the differences in sales by department.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://business-science.github.io/timetk/reference/plot_time_series.html" class="external-link">plot_time_series</a></span><span class="op">(</span>
    <span class="va">date</span>, <span class="va">value</span>, .interactive <span class="op">=</span> <span class="cn">F</span>, .facet_ncol <span class="op">=</span> <span class="fl">2</span>
  <span class="op">)</span></code></pre></div>
<p><img src="nested-forecasting_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;"></p>
<p>We can clearly see that there are 7 time series groups with different weekly sales patterns.</p>
</div>
<div class="section level3">
<h3 id="nested-forecasting-preparation">Nested Forecasting Preparation<a class="anchor" aria-label="anchor" href="#nested-forecasting-preparation"></a>
</h3>
<p>There are two key components that we need to prepare for:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Nested Data Structure:</strong> Most critical to ensure your data is prepared (covered next)</p></li>
<li><p><strong>Nested Modeltime Workflow:</strong> This stage is where we create many models, fit the models to the data, and generate forecasts at scale</p></li>
</ol>
<p>Conceptually, the workflow looks like this where we combine nested data and tidymodels workflows using an upcoming function, <code><a href="../reference/modeltime_nested_fit.html">modeltime_nested_fit()</a></code>.</p>
<p><img src="modeltime_nested_fit.jpg" width="80%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="data-preparation">Data Preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>The most critical stage in <strong>“Nested Forecasting”</strong> is data preparation, making sure that the input to the nested forecasting workflow is in the appropriate structure. We’ve included several functions to help that involve a bit of forethought that can be broken into 3 steps:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Extending each of the times series:</strong> How far into the future do you need to predict for each time series? See <code><a href="../reference/prep_nested.html">extend_timeseries()</a></code>.</p></li>
<li><p><strong>Nesting by the grouping variable:</strong> This is where you create the nested structure. You’ll identify the ID column that separates each time series, and the number of timestamps to include in the “.future_data” and optionally “.actual_data”. Typically, you’ll select the same <code>.length_future</code> as your extension from the previous step. See <code><a href="../reference/prep_nested.html">nest_timeseries()</a></code>.</p></li>
<li><p><strong>Train/Test Set Splitting:</strong> Finally, you’ll take your <code>.actual_data</code> and convert into train/test splits that can be used for accuracy and confidence interval estimation. See <code><a href="../reference/prep_nested.html">split_nested_timeseries()</a></code>.</p></li>
</ol>
<p>Here are the 3-steps in action:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nested_data_tbl</span> <span class="op">&lt;-</span> <span class="va">data_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    
    <span class="co"># 1. Extending: We'll predict 52 weeks into the future.</span>
    <span class="fu"><a href="../reference/prep_nested.html">extend_timeseries</a></span><span class="op">(</span>
        .id_var        <span class="op">=</span> <span class="va">id</span>,
        .date_var      <span class="op">=</span> <span class="va">date</span>,
        .length_future <span class="op">=</span> <span class="fl">52</span>
    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    
    <span class="co"># 2. Nesting: We'll group by id, and create a future dataset</span>
    <span class="co">#    that forecasts 52 weeks of extended data and</span>
    <span class="co">#    an actual dataset that contains 104 weeks (2-years of data)</span>
    <span class="fu"><a href="../reference/prep_nested.html">nest_timeseries</a></span><span class="op">(</span>
        .id_var        <span class="op">=</span> <span class="va">id</span>,
        .length_future <span class="op">=</span> <span class="fl">52</span>,
        .length_actual <span class="op">=</span> <span class="fl">52</span><span class="op">*</span><span class="fl">2</span>
    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    
   <span class="co"># 3. Splitting: We'll take the actual data and create splits</span>
   <span class="co">#    for accuracy and confidence interval estimation of 52 weeks (test)</span>
   <span class="co">#    and the rest is training data</span>
    <span class="fu"><a href="../reference/prep_nested.html">split_nested_timeseries</a></span><span class="op">(</span>
        .length_test <span class="op">=</span> <span class="fl">52</span>
    <span class="op">)</span>

<span class="va">nested_data_tbl</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 4</span></span>
<span class="co">#&gt;   id    .actual_data       .future_data      .splits        </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1_1   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1_3   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1_8   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1_13  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1_38  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1_93  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 1_95  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span></span></code></pre></div>
<p>This creates a nested tibble with “.actual_data”, “.future_data”, and “.splits”. Each column will help in the nested modeltime workflow.</p>
</div>
<div class="section level2">
<h2 id="nested-modeltime-workflow">Nested Modeltime Workflow<a class="anchor" aria-label="anchor" href="#nested-modeltime-workflow"></a>
</h2>
<p>Next, we move into the <strong>Nested Modeltime Workflow</strong> now that nested data has been created. The Nested Modeltime Workflow includes 3 core functions:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Modeling Fitting:</strong> This is the training stage where we fit to <em>training data</em>. The <em>test forecast</em> is generated from this step. See <code><a href="../reference/modeltime_nested_fit.html">modeltime_nested_fit()</a></code>.</p></li>
<li><p><strong>Model Evaluation and Selection:</strong> This is where we review model performance and select the best model by minimizing or maximizing an error metric. See <code><a href="../reference/modeltime_nested_select_best.html">modeltime_nested_select_best()</a></code>.</p></li>
<li><p><strong>Model Refitting:</strong> This is the final fitting stage where we fit to <em>actual data</em>. The <em>future forecast</em> is generated from this step. See <code><a href="../reference/modeltime_nested_refit.html">modeltime_nested_refit()</a></code>.</p></li>
</ol>
<p><img src="nested-core-functions.jpg" width="80%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="step-1-create-tidymodels-workflows">Step 1: Create Tidymodels Workflows<a class="anchor" aria-label="anchor" href="#step-1-create-tidymodels-workflows"></a>
</h3>
<p>First, we create <code>tidymodels</code> workflows for the various models that you intend to create.</p>
<div class="section level4">
<h4 id="prophet">Prophet<a class="anchor" aria-label="anchor" href="#prophet"></a>
</h4>
<p>A common modeling method is prophet, that can be created using <code><a href="../reference/prophet_reg.html">prophet_reg()</a></code>. We’ll create a workflow. Note that we use the <code>extract_nested_train_split(nested_data_tbl)</code> to help us build preprocessing features.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rec_prophet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">date</span>, <span class="fu"><a href="../reference/log_extractors.html">extract_nested_train_split</a></span><span class="op">(</span><span class="va">nested_data_tbl</span><span class="op">)</span><span class="op">)</span> 

<span class="va">wflw_prophet</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">add_model</span><span class="op">(</span>
      <span class="fu"><a href="../reference/prophet_reg.html">prophet_reg</a></span><span class="op">(</span><span class="st">"regression"</span>, seasonality_yearly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
        <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"prophet"</span><span class="op">)</span>
    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">add_recipe</span><span class="op">(</span><span class="va">rec_prophet</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="xgboost">XGBoost<a class="anchor" aria-label="anchor" href="#xgboost"></a>
</h4>
<p>Next, we can use a machine learning method that can get good results: XGBoost. We will add a few extra features in the recipe feature engineering step to generate features that tend to get better modeling results. Note that we use the <code>extract_nested_train_split(nested_data_tbl)</code> to help us build preprocessing features.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rec_xgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html" class="external-link">recipe</a></span><span class="op">(</span><span class="va">value</span> <span class="op">~</span> <span class="va">.</span>, <span class="fu"><a href="../reference/log_extractors.html">extract_nested_train_split</a></span><span class="op">(</span><span class="va">nested_data_tbl</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://business-science.github.io/timetk/reference/step_timeseries_signature.html" class="external-link">step_timeseries_signature</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_rm.html" class="external-link">step_rm</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_zv.html" class="external-link">step_zv</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html" class="external-link">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html" class="external-link">all_nominal_predictors</a></span><span class="op">(</span><span class="op">)</span>, one_hot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">wflw_xgb</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">add_model</span><span class="op">(</span><span class="fu"><a href="https://parsnip.tidymodels.org/reference/boost_tree.html" class="external-link">boost_tree</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"xgboost"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">add_recipe</span><span class="op">(</span><span class="va">rec_xgb</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="step-2-nested-modeltime-tables">Step 2: Nested Modeltime Tables<a class="anchor" aria-label="anchor" href="#step-2-nested-modeltime-tables"></a>
</h3>
<p>With a couple of modeling workflows in hand, we are now ready to test them on each of the time series. We start by using the <code><a href="../reference/modeltime_nested_fit.html">modeltime_nested_fit()</a></code> function, which iteratively fits each model to each of the nested time series train/test “.splits” column.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nested_modeltime_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modeltime_nested_fit.html">modeltime_nested_fit</a></span><span class="op">(</span>
  <span class="co"># Nested data </span>
  nested_data <span class="op">=</span> <span class="va">nested_data_tbl</span>,
  
  <span class="co"># Add workflows</span>
  <span class="va">wflw_prophet</span>,
  <span class="va">wflw_xgb</span>
<span class="op">)</span>
<span class="co">#&gt; Fitting models on training data... <span style="color: #00BB00;">■■■■■                           </span>  14% | ETA:…</span>
<span class="co">#&gt; Fitting models on training data... <span style="color: #00BB00;">■■■■■■■■■■■■■■                  </span>  43% | ETA:…</span>
<span class="co">#&gt; Fitting models on training data... <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■■■■■          </span>  71% | ETA:…</span>
<span class="co">#&gt; Fitting models on training data... <span style="color: #00BB00;">■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■ </span> 100% | ETA:…</span>

<span class="va">nested_modeltime_tbl</span>
<span class="co">#&gt; # Nested Modeltime Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #555555;">Trained on: .splits | Model Errors: [0]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 5</span></span>
<span class="co">#&gt;   id    .actual_data       .future_data      .splits         .modeltime_tables</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1_1   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1_3   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1_8   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1_13  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1_38  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1_93  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 1_95  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;</span></code></pre></div>
<p>This adds a new column with <code>.modeltime_tables</code> for each of the data sets and has created several <strong>logged attributes</strong> that are part of the “Nested Modeltime Table”. We also can see that the models were trained on “.splits” and none of the models had any errors.</p>
</div>
<div class="section level3">
<h3 id="step-3-logged-attributes">Step 3: Logged Attributes<a class="anchor" aria-label="anchor" href="#step-3-logged-attributes"></a>
</h3>
<p>During the forecasting, the iterative modeltime fitting process logs important information that enable us to evaluate the models. These logged attributes are accessable with “extract” functions.</p>
<div class="section level4">
<h4 id="extract-nested-test-accuracy">Extract Nested Test Accuracy<a class="anchor" aria-label="anchor" href="#extract-nested-test-accuracy"></a>
</h4>
<p>Using the <code><a href="../reference/log_extractors.html">extract_nested_test_accuracy()</a></code>, we can get the accuracy measures by time series and model. This allows us to see which model performs best on which time series.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/log_extractors.html">extract_nested_test_accuracy</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/table_modeltime_accuracy.html">table_modeltime_accuracy</a></span><span class="op">(</span>.interactive <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<div id="nuqpghjdgg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#nuqpghjdgg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nuqpghjdgg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nuqpghjdgg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nuqpghjdgg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nuqpghjdgg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nuqpghjdgg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nuqpghjdgg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nuqpghjdgg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nuqpghjdgg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nuqpghjdgg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nuqpghjdgg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nuqpghjdgg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#nuqpghjdgg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nuqpghjdgg .gt_from_md > :first-child {
  margin-top: 0;
}

#nuqpghjdgg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nuqpghjdgg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nuqpghjdgg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nuqpghjdgg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nuqpghjdgg .gt_row_group_first td {
  border-top-width: 2px;
}

#nuqpghjdgg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nuqpghjdgg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nuqpghjdgg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nuqpghjdgg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nuqpghjdgg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nuqpghjdgg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nuqpghjdgg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nuqpghjdgg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nuqpghjdgg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nuqpghjdgg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nuqpghjdgg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nuqpghjdgg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nuqpghjdgg .gt_left {
  text-align: left;
}

#nuqpghjdgg .gt_center {
  text-align: center;
}

#nuqpghjdgg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nuqpghjdgg .gt_font_normal {
  font-weight: normal;
}

#nuqpghjdgg .gt_font_bold {
  font-weight: bold;
}

#nuqpghjdgg .gt_font_italic {
  font-style: italic;
}

#nuqpghjdgg .gt_super {
  font-size: 65%;
}

#nuqpghjdgg .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#nuqpghjdgg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nuqpghjdgg .gt_slash_mark {
  font-size: 0.7em;
  line-height: 0.7em;
  vertical-align: 0.15em;
}

#nuqpghjdgg .gt_fraction_numerator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: 0.45em;
}

#nuqpghjdgg .gt_fraction_denominator {
  font-size: 0.6em;
  line-height: 0.6em;
  vertical-align: -0.05em;
}
</style>
<table class="table gt_table">
<thead class="gt_header"><tr>
<th colspan="10" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Accuracy Table</th>
    </tr></thead>
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">.model_id</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.model_desc</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">.type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mae</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">mase</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">smape</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rmse</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rsq</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td class="gt_row gt_center">1_1</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">PROPHET</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">10071.47</td>
<td class="gt_row gt_right">45.88</td>
<td class="gt_row gt_right">1.99</td>
<td class="gt_row gt_right">59.97</td>
<td class="gt_row gt_right">11776.87</td>
<td class="gt_row gt_right">0.38</td>
</tr>
<tr>
<td class="gt_row gt_center">1_1</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">6223.73</td>
<td class="gt_row gt_right">25.25</td>
<td class="gt_row gt_right">1.23</td>
<td class="gt_row gt_right">24.50</td>
<td class="gt_row gt_right">9026.26</td>
<td class="gt_row gt_right">0.19</td>
</tr>
<tr>
<td class="gt_row gt_center">1_3</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">PROPHET</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">3539.80</td>
<td class="gt_row gt_right">29.87</td>
<td class="gt_row gt_right">1.37</td>
<td class="gt_row gt_right">25.46</td>
<td class="gt_row gt_right">4707.77</td>
<td class="gt_row gt_right">0.80</td>
</tr>
<tr>
<td class="gt_row gt_center">1_3</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">3071.25</td>
<td class="gt_row gt_right">18.74</td>
<td class="gt_row gt_right">1.19</td>
<td class="gt_row gt_right">20.26</td>
<td class="gt_row gt_right">5069.27</td>
<td class="gt_row gt_right">0.79</td>
</tr>
<tr>
<td class="gt_row gt_center">1_8</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">PROPHET</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">4282.96</td>
<td class="gt_row gt_right">11.15</td>
<td class="gt_row gt_right">1.82</td>
<td class="gt_row gt_right">11.96</td>
<td class="gt_row gt_right">4845.08</td>
<td class="gt_row gt_right">0.00</td>
</tr>
<tr>
<td class="gt_row gt_center">1_8</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">3608.13</td>
<td class="gt_row gt_right">9.39</td>
<td class="gt_row gt_right">1.53</td>
<td class="gt_row gt_right">9.95</td>
<td class="gt_row gt_right">4025.27</td>
<td class="gt_row gt_right">0.30</td>
</tr>
<tr>
<td class="gt_row gt_center">1_13</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">PROPHET</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">6861.13</td>
<td class="gt_row gt_right">17.02</td>
<td class="gt_row gt_right">2.53</td>
<td class="gt_row gt_right">18.78</td>
<td class="gt_row gt_right">7309.61</td>
<td class="gt_row gt_right">0.15</td>
</tr>
<tr>
<td class="gt_row gt_center">1_13</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">2712.05</td>
<td class="gt_row gt_right">6.73</td>
<td class="gt_row gt_right">1.00</td>
<td class="gt_row gt_right">7.00</td>
<td class="gt_row gt_right">3056.42</td>
<td class="gt_row gt_right">0.55</td>
</tr>
<tr>
<td class="gt_row gt_center">1_38</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">PROPHET</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">26007.21</td>
<td class="gt_row gt_right">32.57</td>
<td class="gt_row gt_right">2.22</td>
<td class="gt_row gt_right">39.60</td>
<td class="gt_row gt_right">27938.83</td>
<td class="gt_row gt_right">0.08</td>
</tr>
<tr>
<td class="gt_row gt_center">1_38</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">7210.40</td>
<td class="gt_row gt_right">8.89</td>
<td class="gt_row gt_right">0.62</td>
<td class="gt_row gt_right">9.20</td>
<td class="gt_row gt_right">9260.56</td>
<td class="gt_row gt_right">0.34</td>
</tr>
<tr>
<td class="gt_row gt_center">1_93</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">PROPHET</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">17165.30</td>
<td class="gt_row gt_right">21.37</td>
<td class="gt_row gt_right">1.73</td>
<td class="gt_row gt_right">24.46</td>
<td class="gt_row gt_right">19123.17</td>
<td class="gt_row gt_right">0.03</td>
</tr>
<tr>
<td class="gt_row gt_center">1_93</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">7327.73</td>
<td class="gt_row gt_right">9.20</td>
<td class="gt_row gt_right">0.74</td>
<td class="gt_row gt_right">9.73</td>
<td class="gt_row gt_right">9061.71</td>
<td class="gt_row gt_right">0.45</td>
</tr>
<tr>
<td class="gt_row gt_center">1_95</td>
<td class="gt_row gt_right">1</td>
<td class="gt_row gt_left">PROPHET</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">22836.06</td>
<td class="gt_row gt_right">18.30</td>
<td class="gt_row gt_right">2.75</td>
<td class="gt_row gt_right">20.37</td>
<td class="gt_row gt_right">24094.49</td>
<td class="gt_row gt_right">0.48</td>
</tr>
<tr>
<td class="gt_row gt_center">1_95</td>
<td class="gt_row gt_right">2</td>
<td class="gt_row gt_left">XGBOOST</td>
<td class="gt_row gt_left">Test</td>
<td class="gt_row gt_right">11896.46</td>
<td class="gt_row gt_right">9.39</td>
<td class="gt_row gt_right">1.43</td>
<td class="gt_row gt_right">9.95</td>
<td class="gt_row gt_right">14105.76</td>
<td class="gt_row gt_right">0.13</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level4">
<h4 id="extract-nested-test-forecast">Extract Nested Test Forecast<a class="anchor" aria-label="anchor" href="#extract-nested-test-forecast"></a>
</h4>
<p>Next, we can visualize the test forecast with <code><a href="../reference/log_extractors.html">extract_nested_test_forecast()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/log_extractors.html">extract_nested_test_forecast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/plot_modeltime_forecast.html">plot_modeltime_forecast</a></span><span class="op">(</span>
    .facet_ncol  <span class="op">=</span> <span class="fl">2</span>,
    .interactive <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span></code></pre></div>
<p><img src="nested-forecasting_files/figure-html/unnamed-chunk-14-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="extract-nested-error-logs">Extract Nested Error Logs<a class="anchor" aria-label="anchor" href="#extract-nested-error-logs"></a>
</h4>
<p>If any of the models have errors, then we can investigate the error logs with <code><a href="../reference/log_extractors.html">extract_nested_error_report()</a></code>. Fortunately, we don’t have any errors, but if we did we could investigate further.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="../reference/log_extractors.html">extract_nested_error_report</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 4</span></span>
<span class="co">#&gt; <span style="color: #949494;"># … with 4 variables: id &lt;fct&gt;, .model_id &lt;int&gt;, .model_desc &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   .error_desc &lt;chr&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="step-4-select-the-best">Step 4: Select the Best<a class="anchor" aria-label="anchor" href="#step-4-select-the-best"></a>
</h3>
<p>Using the accuracy data, we can pick a metric and select the best model based on that metric. The available metrics are in the <code><a href="../reference/metric_sets.html">default_forecast_accuracy_metric_set()</a></code>. Make sure to select <code>minimize</code> based on the metric. The <code>filter_test_forecasts</code> parameter tells the function to filter the logged test forecasts to just the best.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">best_nested_modeltime_tbl</span> <span class="op">&lt;-</span> <span class="va">nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="../reference/modeltime_nested_select_best.html">modeltime_nested_select_best</a></span><span class="op">(</span>
      metric                <span class="op">=</span> <span class="st">"rmse"</span>, 
      minimize              <span class="op">=</span> <span class="cn">TRUE</span>, 
      filter_test_forecasts <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span></code></pre></div>
<p>This identifies which models should be used for the final forecast. With the models selected, we can make the future forecast.</p>
<div class="section level4">
<h4 id="extract-nested-best-model-report">Extract Nested Best Model Report<a class="anchor" aria-label="anchor" href="#extract-nested-best-model-report"></a>
</h4>
<p>The best model selections can be accessed with <code><a href="../reference/log_extractors.html">extract_nested_best_model_report()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">best_nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/log_extractors.html">extract_nested_best_model_report</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; # Nested Modeltime Table</span>
<span class="co">#&gt;   <span style="color: #949494;"># A tibble: 7 × 10</span></span>
<span class="co">#&gt;   id    .model_id .model_desc .type    mae  mape  mase smape   rmse   rsq</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1_1           2 XGBOOST     Test   <span style="text-decoration: underline;">6</span>224. 25.2  1.23  24.5   <span style="text-decoration: underline;">9</span>026. 0.189</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1_3           1 PROPHET     Test   <span style="text-decoration: underline;">3</span>540. 29.9  1.37  25.5   <span style="text-decoration: underline;">4</span>708. 0.796</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1_8           2 XGBOOST     Test   <span style="text-decoration: underline;">3</span>608.  9.39 1.53   9.95  <span style="text-decoration: underline;">4</span>025. 0.304</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1_13          2 XGBOOST     Test   <span style="text-decoration: underline;">2</span>712.  6.73 0.998  7.00  <span style="text-decoration: underline;">3</span>056. 0.551</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1_38          2 XGBOOST     Test   <span style="text-decoration: underline;">7</span>210.  8.89 0.616  9.20  <span style="text-decoration: underline;">9</span>261. 0.339</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1_93          2 XGBOOST     Test   <span style="text-decoration: underline;">7</span>328.  9.20 0.738  9.73  <span style="text-decoration: underline;">9</span>062. 0.450</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 1_95          2 XGBOOST     Test  <span style="text-decoration: underline;">11</span>896.  9.39 1.43   9.95 <span style="text-decoration: underline;">14</span>106. 0.133</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="extract-nested-best-test-forecasts">Extract Nested Best Test Forecasts<a class="anchor" aria-label="anchor" href="#extract-nested-best-test-forecasts"></a>
</h4>
<p>Once we’ve selected the best models, we can easily visualize the best forecasts by time series. Note that the nested test forecast logs have been modified to isolate the best models.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">best_nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/log_extractors.html">extract_nested_test_forecast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/plot_modeltime_forecast.html">plot_modeltime_forecast</a></span><span class="op">(</span>
    .facet_ncol  <span class="op">=</span> <span class="fl">2</span>,
    .interactive <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span></code></pre></div>
<p><img src="nested-forecasting_files/figure-html/unnamed-chunk-18-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="step-5-refitting-and-future-forecast">Step 5: Refitting and Future Forecast<a class="anchor" aria-label="anchor" href="#step-5-refitting-and-future-forecast"></a>
</h3>
<p>With the best models in hand, we can make our future forecasts by refitting the models to the full dataset.</p>
<ul>
<li><p>If the best models have been selected, the only the best models will be refit.</p></li>
<li><p>If best models have not been selected, then all models will be refit.</p></li>
</ul>
<p>We’ve selected our best models, and will move forward with refitting and future forecast logging using the <code><a href="../reference/modeltime_nested_refit.html">modeltime_nested_refit()</a></code> function.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nested_modeltime_refit_tbl</span> <span class="op">&lt;-</span> <span class="va">best_nested_modeltime_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="../reference/modeltime_nested_refit.html">modeltime_nested_refit</a></span><span class="op">(</span>
        control <span class="op">=</span> <span class="fu"><a href="../reference/control_modeltime.html">control_nested_refit</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
    <span class="op">)</span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> [1/7] Starting Modeltime Table: ID 1_1...</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> Model 2 Passed XGBOOST.</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> [1/7] Finished Modeltime Table: ID 1_1</span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> [2/7] Starting Modeltime Table: ID 1_3...</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> Model 1 Passed PROPHET.</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> [2/7] Finished Modeltime Table: ID 1_3</span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> [3/7] Starting Modeltime Table: ID 1_8...</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> Model 2 Passed XGBOOST.</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> [3/7] Finished Modeltime Table: ID 1_8</span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> [4/7] Starting Modeltime Table: ID 1_13...</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> Model 2 Passed XGBOOST.</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> [4/7] Finished Modeltime Table: ID 1_13</span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> [5/7] Starting Modeltime Table: ID 1_38...</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> Model 2 Passed XGBOOST.</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> [5/7] Finished Modeltime Table: ID 1_38</span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> [6/7] Starting Modeltime Table: ID 1_93...</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> Model 2 Passed XGBOOST.</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> [6/7] Finished Modeltime Table: ID 1_93</span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> [7/7] Starting Modeltime Table: ID 1_95...</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> Model 2 Passed XGBOOST.</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> [7/7] Finished Modeltime Table: ID 1_95</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Finished in: 3.561244 secs.</span></code></pre></div>
<p>Note that we used <code>control_nested_refit(verbose = TRUE)</code> to display the modeling results as each model is refit. This is not necessary, but can be useful to follow the nested model fitting process.</p>
<p>We can see that the nested modeltime table appears the same, but has now been trained on <code>.actual_data</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nested_modeltime_refit_tbl</span>
<span class="co">#&gt; # Nested Modeltime Table</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #555555;">Trained on: .actual_data | Model Errors: [0]</span></span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 5</span></span>
<span class="co">#&gt;   id    .actual_data       .future_data      .splits         .modeltime_tables</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1_1   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1_3   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1_8   <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1_13  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1_38  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1_93  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 1_95  <span style="color: #949494;">&lt;tibble [104 × 2]&gt;</span> <span style="color: #949494;">&lt;tibble [52 × 2]&gt;</span> <span style="color: #949494;">&lt;split [52|52]&gt;</span> &lt;mdl_time_tbl&gt;</span></code></pre></div>
<div class="section level4">
<h4 id="extract-nested-future-forecast">Extract Nested Future Forecast<a class="anchor" aria-label="anchor" href="#extract-nested-future-forecast"></a>
</h4>
<p>After the refitting process completes, we can now access the future forecast, which is logged.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nested_modeltime_refit_tbl</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/log_extractors.html">extract_nested_future_forecast</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/plot_modeltime_forecast.html">plot_modeltime_forecast</a></span><span class="op">(</span>
    .interactive <span class="op">=</span> <span class="cn">FALSE</span>,
    .facet_ncol  <span class="op">=</span> <span class="fl">2</span>
  <span class="op">)</span></code></pre></div>
<p><img src="nested-forecasting_files/figure-html/unnamed-chunk-21-1.png" width="100%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>We’ve now successfully completed a <strong>Nested Forecast.</strong> You may find this challenging, especially if you are not familiar with the Modeltime Workflow, terminology, or tidymodeling in R. If this is the case, we have a solution. Take our high-performance forecasting course.</p>
</div>
<div class="section level2">
<h2 id="take-the-high-performance-forecasting-course">Take the High-Performance Forecasting Course<a class="anchor" aria-label="anchor" href="#take-the-high-performance-forecasting-course"></a>
</h2>
<blockquote>
<p>Become the forecasting expert for your organization</p>
</blockquote>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/" target="_blank" class="external-link"><img src="https://www.filepicker.io/api/file/bKyqVAi5Qi64sS05QYLk" alt="High-Performance Time Series Forecasting Course" width="100%" style="box-shadow: 0 0 5px 2px rgba(0, 0, 0, .5);"></a></p>
<p><a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting/" class="external-link"><em>High-Performance Time Series Course</em></a></p>
<div class="section level3">
<h3 id="time-series-is-changing">Time Series is Changing<a class="anchor" aria-label="anchor" href="#time-series-is-changing"></a>
</h3>
<p>Time series is changing. <strong>Businesses now need 10,000+ time series forecasts every day.</strong> This is what I call a <em>High-Performance Time Series Forecasting System (HPTSF)</em> - Accurate, Robust, and Scalable Forecasting.</p>
<p><strong>High-Performance Forecasting Systems will save companies by improving accuracy and scalability.</strong> Imagine what will happen to your career if you can provide your organization a “High-Performance Time Series Forecasting System” (HPTSF System).</p>
</div>
<div class="section level3">
<h3 id="how-to-learn-high-performance-time-series-forecasting">How to Learn High-Performance Time Series Forecasting<a class="anchor" aria-label="anchor" href="#how-to-learn-high-performance-time-series-forecasting"></a>
</h3>
<p>I teach how to build a HPTFS System in my <a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting" class="external-link"><strong>High-Performance Time Series Forecasting Course</strong></a>. You will learn:</p>
<ul>
<li>
<strong>Time Series Machine Learning</strong> (cutting-edge) with <code>Modeltime</code> - 30+ Models (Prophet, ARIMA, XGBoost, Random Forest, &amp; many more)</li>
<li>
<strong>Deep Learning</strong> with <code>GluonTS</code> (Competition Winners)</li>
<li>
<strong>Time Series Preprocessing</strong>, Noise Reduction, &amp; Anomaly Detection</li>
<li>
<strong>Feature engineering</strong> using lagged variables &amp; external regressors</li>
<li><strong>Hyperparameter Tuning</strong></li>
<li><strong>Time series cross-validation</strong></li>
<li>
<strong>Ensembling</strong> Multiple Machine Learning &amp; Univariate Modeling Techniques (Competition Winner)</li>
<li>
<strong>Scalable Forecasting</strong> - Forecast 1000+ time series in parallel</li>
<li>and more.</li>
</ul>
<p class="text-center" style="font-size:24px;">
Become the Time Series Expert for your organization.
</p>
<br><p class="text-center" style="font-size:30px;">
<a href="https://university.business-science.io/p/ds4b-203-r-high-performance-time-series-forecasting" class="external-link">Take the High-Performance Time Series Forecasting Course</a>
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matt Dancho.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
